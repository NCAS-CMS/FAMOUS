#!/bin/ksh                                                                 unpackmodel.2     
# ----------------------------- COPYRIGHT ---------------------------- #   unpackmodel.3     
#          (c) BRITISH CROWN COPYRIGHT 1999, THE MET.OFFICE            #   unpackmodel.4     
#                                                                      #   unpackmodel.5     
# Use, duplication or disclosure of this code is subject to the        #   unpackmodel.6     
# restrictions as set forth in the contract. If no contract has been   #   unpackmodel.7     
# raised with this copy of the code, use, duplication or disclosure    #   unpackmodel.8     
# of it is strictly prohibited. Permission to do so must first be      #   unpackmodel.9     
# obtained in writing from the Head of Numerical Modelling at UKMO.    #   unpackmodel.10    
# ----------------------------- COPYRIGHT ---------------------------- #   unpackmodel.11    
#LL---------------------------------------------------------------------   unpackmodel.12    
#LL  Script:  unpackmodel                                                  unpackmodel.13    
#LL---------------------------------------------------------------------   unpackmodel.14    
#LL                                                                        unpackmodel.15    
#LL  Purpose: Generates scripts and global variables required for          unpackmodel.16    
#LL           building the unified model.                                  unpackmodel.17    
#LL                                                                        unpackmodel.18    
#LL  Current Owner: Anette Van der Wal                                     unpackmodel.19    
#LL  Reviewer:                Date of review:                              unpackmodel.20    
#LL                                                                        unpackmodel.21    
#LL  Tested under OS version: Digital OSF1 V4.0                            unpackmodel.22    
#LL  UM version no: 4.5(p)  Date of test: 22nd September 1999              unpackmodel.23    
#LL                                                                        unpackmodel.24    
#LL  History:                                                              unpackmodel.25    
#LL   Model                                                                unpackmodel.26    
#LL  version  Date      Modification history:                              unpackmodel.27    
#LL    3.2    04/06/93  Original version (Paul Burton)                     unpackmodel.28    
#LL    3.4    29/06/94  Changed directory structure                        unpackmodel.29    
#LL                     Also modified header layout.  (Tracey Smith)       unpackmodel.30    
#LL    3.4    05/09/94  Removed makescritps step and changed               unpackmodel.31    
#LL                     install to Install (T Smith)                       unpackmodel.32    
#LL    3.4    03/11/94  Remove #!/bin/sh  (T Smith)                        unpackmodel.33    
#LL    3.4    18/01/95  Major rewrite for vn3.4 (T Smith)                  unpackmodel.34    
#LL    3.5    07/02/95  Improved unpacking of the Portable model           unpackmodel.35    
#LL                             (Tracey Smith & Nicola Farnon)             unpackmodel.36    
#LL    4.0    07/02/95  Introduce option for other platforms to compile    unpackmodel.37    
#LL                     the UM scripts automatically. (N.Farnon)           unpackmodel.38    
#LL    4.1    16/04/96  Major simplification. (Mussadiq Ahmed)             unpackmodel.39    
#LL    4.1    20/05/96  Edited to enable use on Met Office C90             unpackmodel.40    
#LL                     G Henderson                                        unpackmodel.41    
#LL    4.1    13/05/96  Use nupdate to extract mkscripts(Mussadiq Ahmed)   unpackmodel.42    
#LL    4.2    14/10/96  Changes for T3E                                    unpackmodel.43    
#LL    4.3    26/02/97  unpackmodel changed for new build scripts          unpackmodel.44    
#LL                     Lexcon is no longer supported and has been         unpackmodel.45    
#LL                     removed. - Nicola Farnon                           unpackmodel.46    
#LL    4.3    04/03/97  Replace buildhost type GENERIC with workstation    unpackmodel.47    
#LL                     specific buildhosts HP_f77 and Dec_f77. This was   unpackmodel.48    
#LL                     done to aid testing, by getting a system up and    unpackmodel.49    
#LL                     running, without making changes to the current     unpackmodel.50    
#LL                     compile system structure.  Hand edits to the       unpackmodel.51    
#LL                     obj_xref file will be required if a system which   unpackmodel.52    
#LL                     not supported directly is set up.                  unpackmodel.53    
#LL    4.4    15/10/97  Add in step to create an obj_xref file for the     unpackmodel.54    
#LL                     platform the UM scripts are being installed        unpackmodel.55    
#LL                     upon.  (S Robertson)                               unpackmodel.56    
#LL    4.4    18/11/97  remove the untarring of portable UM                unpackmodel.57    
#LL                     for external users (Mussadiq Ahmed)                unpackmodel.58    
#LL    4.4    10/11/97  Changed to use ${NPROC:-8} in setglobalvars        unpackmodel.59    
#LL                     in case NPROC overidden by user.  K Rogers         unpackmodel.60    
#LL    4.5    15/09/98  Removed UMVERSION, updated PROGDEFS. K Rogers      unpackmodel.61    
#LL    4.5    12/06/98  Changed FORT to FFORT, and added LLOAD and LOPTS   unpackmodel.62    
#LL                     Added "" around FOPTS, LOPTS and COPTS             unpackmodel.63    
#LL                     (A Van der Wal)                                    unpackmodel.64    
#LL    4.5    12/06/98  Reset PROGDEFS and remove redundant code           unpackmodel.65    
#LL                     Add F_C_LINK default values                        unpackmodel.66    
#LL                     Add missing CRAY DEF question                      unpackmodel.67    
#LL                     (A Van der Wal)                                    unpackmodel.68    
#LL    4.5    14/07/98  Added FPATH to setvars and setglobalvars           unpackmodel.69    
#LL    4.5    03/08/98  Additional questions for Fujitsu (A Van der Wal)   unpackmodel.70    
#LL    4.5(p) 22/09/99  Major re-write for portable vn4.5                  unpackmodel.71    
#LL                                                                        unpackmodel.72    
#LL  Programming standard: UMDP 3, version 7                               unpackmodel.73    
#LL                                                                        unpackmodel.74    
#LL  Project task:                                                         unpackmodel.75    
#LL                                                                        unpackmodel.76    
#LL  Logical components covered:                                           unpackmodel.77    
#LL                                                                        unpackmodel.78    
#LL  External documentation: UMDP X4, version 7                            unpackmodel.79    
#LL                                                                        unpackmodel.80    
#L   Interface and arguments:                                              unpackmodel.81    
#L                                                                         unpackmodel.82    
#L   unpackmodel                                                           unpackmodel.83    
#L                                                                         unpackmodel.84    
#L   -------------------------------------------------------------------   unpackmodel.85    
#L                                                                         unpackmodel.86    
#L   Called by: None                                                       unpackmodel.87    
#L   Calls    : setvars (note: setvars is created within this script)      unpackmodel.88    
#L            : makescripts                                                unpackmodel.89    
#L            : mkobjxref                                                  unpackmodel.90    
#L            : mkexecxref                                                 unpackmodel.91    
#L            : mkcompvars                                                 unpackmodel.92    
#L                                                                         unpackmodel.93    
#L   Imports:                                                              unpackmodel.94    
#L                                                                         unpackmodel.95    
#L   Exports:                                                              unpackmodel.96    
#L     UMMACHINE        - machine UM will run on                           unpackmodel.97    
#L     BUILDHOST        - a build name; machine name and compiler          unpackmodel.98    
#L     UM_SECTOR_SIZE   - size of disk sectors for well-formed I/O         unpackmodel.99    
#L     UM_HOME          - UM user home directory                           unpackmodel.100   
#L     UMDIR		- main UM directory                                          unpackmodel.101   
#L     UM_TMP           - UM temporary directory                           unpackmodel.102   
#L     MY_OUTPUT        - Output directory                                 unpackmodel.103   
#L     SCRMODS          - Mods for scripts, applied as they are unpacked   unpackmodel.104   
#L     NPROC            - Number of processors for parallel compiles       unpackmodel.105   
#L     CCOM_CMD         - c compiler name                                  unpackmodel.106   
#L     CCOM_OPTS        - c compiler options                               unpackmodel.107   
#L     CCOM_OPTIM       - c compiler optimizations                         unpackmodel.108   
#L     FCOM_CMD         - fortran compiler name                            unpackmodel.109   
#L     FCOM_OPTS        - fortran compiler options                         unpackmodel.110   
#L     FCOM_OPTIM       - fortran compiler optimizations                   unpackmodel.111   
#L     LCOM_CMD         - load command                                     unpackmodel.112   
#L     LCOM_OPTS        - load options                                     unpackmodel.113   
#L     LCOM_PATH        - load path                                        unpackmodel.114   
#L     LCOM_LIBS        - load libraries                                   unpackmodel.115   
#L     COM_SPECIFIC     - file containing deck specific compile options    unpackmodel.116   
#L     FC_LINK          - fortran-C interface                              unpackmodel.117   
#L     FRL8             - c equivalent of fortran real                     unpackmodel.118   
#L     BIGEND           - is the platform bigendian                        unpackmodel.119   
#L     USE_CRAY_NUPDATE - use cray version of nupdate?                     unpackmodel.120   
#L     UPDATEVN		- nupdate version number                                  unpackmodel.121   
#L     UPDATEDIR        - directory containing nupdate directory           unpackmodel.122   
#L     UM_PE_LABEL      - label for the high memory PE (if applicable)     unpackmodel.123   
#L     PROGDEFS         - list of *DEFS for the source code                unpackmodel.124   
#L     (made up of FC_LINK, FRL8, MPP, MPPRECON, BLDNOMPP, CRAY,           unpackmodel.125   
#L      CRI_OPEN, T3E, T3D, FUJITSU, VECTLIB)                              unpackmodel.126   
#L     SCRDEFS          - list of *DEFS for the scripts                    unpackmodel.127   
#L     (made up of UMMACHINE, CRAYMPP, VECTLIB, MPP, CRAYF90)              unpackmodel.128   
#L     FPATH                                                               unpackmodel.129   
#L                                                                         unpackmodel.130   
#L   Local variables:                                                      unpackmodel.131   
#L     LOG              - output log file                                  unpackmodel.132   
#L     CONFIG           - confiuration file                                unpackmodel.133   
#L     CONFIG_TMP       - temporary configuration file                     unpackmodel.134   
#L     MACH_DEFS        - file of machine default answers                  unpackmodel.135   
#L     FCTEST           - directory containing the fc_test utility         unpackmodel.136   
#L     FCTEST_TMP       - temporary file containing output from fc_test    unpackmodel.137   
#L     FIGLET           - directory containing the figlet source code      unpackmodel.138   
#L     FIGLET_UTIL      - directory where the figlet executable will go    unpackmodel.139   
#L     BIGEND_UTIL      - directory containing the bigend utility          unpackmodel.140   
#L     TMPFILE          - a temporary file                                 unpackmodel.141   
#L     ANSWER           - used to read user input                          unpackmodel.142   
#L     FRL_SIZE         - size of a Fortran real                           unpackmodel.143   
#L     USE_CONFIG       - use answers from the configuration file          unpackmodel.144   
#L     PLATFORM         - number of the chosen platform                    unpackmodel.145   
#L     VALID            - signifies whether answer is valid                unpackmodel.146   
#L                                                                         unpackmodel.147   
#L End of header -------------------------------------------------------   unpackmodel.148   
                                                                           unpackmodel.149   
#=======================================================================   unpackmodel.150   
# File names                                                               unpackmodel.151   
                                                                           unpackmodel.152   
set -a                                                                     unpackmodel.153   
VN=4.5                                                                     unpackmodel.154   
                                                                           unpackmodel.155   
LOG=$HOME/unpack_$VN.log                                                   unpackmodel.156   
CONFIG=$HOME/config_$VN.cache                                              unpackmodel.157   
CONFIG_TMP=$HOME/config_$VN.cache.tmp                                      unpackmodel.158   
FCTEST=\$UMDIR/vn$VN/utils/fc_test-1.1                                     unpackmodel.159   
FCTEST_TMP=$HOME/fctest_out                                                unpackmodel.160   
FIGLET=\$UMDIR/vn$VN/utils/figlet-2.2                                      unpackmodel.161   
FIGLET_UTIL=\$UMDIR/bin/figlet                                             unpackmodel.162   
BIGEND_UTIL=\$UMDIR/vn$VN/utils/bigend-1.1                                 unpackmodel.163   
UPDATE_DEF=0.4.9                                                           unpackmodel.164   
TMPFILE=/tmp/um45unpack                                                    unpackmodel.165   
                                                                           unpackmodel.166   
FIRST=`echo $0 | cut -c1`                                                  unpackmodel.167   
if test "$FIRST" = "/"; then                                               unpackmodel.168   
  MACH_PATH=`dirname $0`                                                   unpackmodel.169   
else                                                                       unpackmodel.170   
  MACH_PATH="`pwd`/`dirname $0`"                                           unpackmodel.171   
fi                                                                         unpackmodel.172   
MACH_DEFS=$MACH_PATH/mach_defaults                                         unpackmodel.173   
                                                                           unpackmodel.174   
#=======================================================================   unpackmodel.175   
# Functions                                                                unpackmodel.176   
                                                                           unpackmodel.177   
check_tf()                                                                 unpackmodel.178   
{                                                                          unpackmodel.179   
  # Checks for a true or false answer                                      unpackmodel.180   
                                                                           unpackmodel.181   
  ANSWER=null                                                              unpackmodel.182   
  DEFAULT=$1                                                               unpackmodel.183   
  while test "$ANSWER" = "null"; do                                        unpackmodel.184   
    read ANSWER                                                            unpackmodel.185   
    ANSWER=${ANSWER:-$DEFAULT}                                             unpackmodel.186   
    ANSWER=`echo $ANSWER | tr "[A-Z]" "[a-z]"`                             unpackmodel.187   
                                                                           unpackmodel.188   
    case $ANSWER in                                                        unpackmodel.189   
      t | true  | y | yes ) ANSWER=true;;                                  unpackmodel.190   
      f | false | n | no  ) ANSWER=false;;                                 unpackmodel.191   
      q | quit  | x | exit) exit;;                                         unpackmodel.192   
      *                   ) ANSWER=null;;                                  unpackmodel.193   
    esac                                                                   unpackmodel.194   
                                                                           unpackmodel.195   
    if test "$ANSWER" = "null"; then                                       unpackmodel.196   
      echo "Invalid response"                                              unpackmodel.197   
      echo "Please re-enter your answer"                                   unpackmodel.198   
    fi                                                                     unpackmodel.199   
  done                                                                     unpackmodel.200   
}                                                                          unpackmodel.201   
                                                                           unpackmodel.202   
getvar()                                                                   unpackmodel.203   
{                                                                          unpackmodel.204   
  VARNAME=$1                                                               unpackmodel.205   
  FILE=$2                                                                  unpackmodel.206   
                                                                           unpackmodel.207   
  LINE=`grep "^${VARNAME}=" $FILE`                                         unpackmodel.208   
  CC=$?                                                                    unpackmodel.209   
  if test $CC -eq 0; then                                                  unpackmodel.210   
    OUTVAR=`echo $LINE | cut -f2- -d"="`                                   unpackmodel.211   
    echo $OUTVAR                                                           unpackmodel.212   
  else                                                                     unpackmodel.213   
    exit 1                                                                 unpackmodel.214   
  fi                                                                       unpackmodel.215   
}                                                                          unpackmodel.216   
                                                                           unpackmodel.217   
testcc()                                                                   unpackmodel.218   
{                                                                          unpackmodel.219   
  CC=$1                                                                    unpackmodel.220   
  INFO=$2                                                                  unpackmodel.221   
                                                                           unpackmodel.222   
  if test $CC -ne 0; then                                                  unpackmodel.223   
    echo "Unpackmodel: An error has been detected whilst"                  unpackmodel.224   
    echo "             $INFO"                                              unpackmodel.225   
    echo "Unpackmodel: Program terminating"                                unpackmodel.226   
    exit 1                                                                 unpackmodel.227   
  fi                                                                       unpackmodel.228   
}                                                                          unpackmodel.229   
                                                                           unpackmodel.230   
                                                                           unpackmodel.231   
#=======================================================================   unpackmodel.232   
# Start                                                                    unpackmodel.233   
                                                                           unpackmodel.234   
echo "--------------------------------------------------------"            unpackmodel.235   
echo "       UK MET. OFFICE UNIFIED MODEL VERSION $VN         "            unpackmodel.236   
echo "                                                        "            unpackmodel.237   
echo "Please read Document X4 - Guidelines for Building the   "            unpackmodel.238   
echo "Unified Model on External Systems - before continuing   "            unpackmodel.239   
echo "                                                        "            unpackmodel.240   
echo "Progress will be recorded in the file:                  "            unpackmodel.241   
echo "$LOG"                                                                unpackmodel.242   
echo "                                                        "            unpackmodel.243   
echo "Where applicable, default answers are given in [] after "            unpackmodel.244   
echo "the question; hitting <return> will select the default  "            unpackmodel.245   
echo "                                                        "            unpackmodel.246   
echo "Default answers will be taken from the file:            "            unpackmodel.247   
echo "$CONFIG"                                                             unpackmodel.248   
echo "if it exists, otherwise from                            "            unpackmodel.249   
echo "$MACH_DEFS"                                                          unpackmodel.250   
echo "--------------------------------------------------------"            unpackmodel.251   
echo                                                                       unpackmodel.252   
echo "Press RETURN to continue..."                                         unpackmodel.253   
read ANSWER                                                                unpackmodel.254   
echo                                                                       unpackmodel.255   
                                                                           unpackmodel.256   
# Check if log file already exists                                         unpackmodel.257   
                                                                           unpackmodel.258   
if test -s $LOG; then                                                      unpackmodel.259   
  echo "$LOG exists"                                                       unpackmodel.260   
  echo "Overwrite? [n]"                                                    unpackmodel.261   
  check_tf n                                                               unpackmodel.262   
  if test "$ANSWER" = "false"; then                                        unpackmodel.263   
    exit                                                                   unpackmodel.264   
  fi                                                                       unpackmodel.265   
  echo                                                                     unpackmodel.266   
fi                                                                         unpackmodel.267   
                                                                           unpackmodel.268   
echo "Stage 0 - Preliminaries" >> $LOG                                     unpackmodel.269   
echo "-----------------------" >> $LOG                                     unpackmodel.270   
echo >> $LOG                                                               unpackmodel.271   
                                                                           unpackmodel.272   
echo "--------------------------------------------------------"            unpackmodel.273   
echo " Step 0.1: Check Machine Defaults File Exists           "            unpackmodel.274   
echo "--------------------------------------------------------"            unpackmodel.275   
echo                                                                       unpackmodel.276   
                                                                           unpackmodel.277   
if test -s "$MACH_DEFS"; then                                              unpackmodel.278   
  chmod 755 $MACH_DEFS                                                     unpackmodel.279   
  echo "Machine defaults file: $MACH_DEFS" >> $LOG                         unpackmodel.280   
else                                                                       unpackmodel.281   
  echo "File $MACH_DEFS doesn't exist"                                     unpackmodel.282   
  echo "Please extract from umsl before proceeding"                        unpackmodel.283   
  exit 1                                                                   unpackmodel.284   
fi                                                                         unpackmodel.285   
                                                                           unpackmodel.286   
echo "--------------------------------------------------------"            unpackmodel.287   
echo " Step 0.2: Choose Source of Defaults                    "            unpackmodel.288   
echo "--------------------------------------------------------"            unpackmodel.289   
echo                                                                       unpackmodel.290   
                                                                           unpackmodel.291   
USE_CONFIG=false                                                           unpackmodel.292   
if test -s $CONFIG; then                                                   unpackmodel.293   
  echo "$CONFIG exists"                                                    unpackmodel.294   
  echo "Use the defaults from here? [y]"                                   unpackmodel.295   
  check_tf y                                                               unpackmodel.296   
  USE_CONFIG=$ANSWER                                                       unpackmodel.297   
  echo                                                                     unpackmodel.298   
fi                                                                         unpackmodel.299   
                                                                           unpackmodel.300   
if test "$USE_CONFIG" = "true"; then                                       unpackmodel.301   
  echo "Defaults taken from $CONFIG" | tee -a $LOG                         unpackmodel.302   
  PLATFORM=`getvar PLATFORM $CONFIG`                                       unpackmodel.303   
else                                                                       unpackmodel.304   
  echo "Defaults taken from $MACH_DEFS" | tee -a $LOG                      unpackmodel.305   
  rm -rf $CONFIG                                                           unpackmodel.306   
  PLATFORM=1                                                               unpackmodel.307   
  SKIP_QUESTIONS="false"                                                   unpackmodel.308   
fi                                                                         unpackmodel.309   
echo                                                                       unpackmodel.310   
                                                                           unpackmodel.311   
if test "$USE_CONFIG" = "true"; then                                       unpackmodel.312   
                                                                           unpackmodel.313   
  echo "--------------------------------------------------------"          unpackmodel.314   
  echo " Step 0.3: Choose Quick or Slow Unpack                  "          unpackmodel.315   
  echo "--------------------------------------------------------"          unpackmodel.316   
  echo                                                                     unpackmodel.317   
  echo "Unpack the UM, taking answers directly from"                       unpackmodel.318   
  echo "${CONFIG}? [n]"                                                    unpackmodel.319   
  check_tf n                                                               unpackmodel.320   
  if test "$ANSWER" = "false"; then                                        unpackmodel.321   
    SKIP_QUESTIONS="false"                                                 unpackmodel.322   
  else                                                                     unpackmodel.323   
    SKIP_QUESTIONS="true"                                                  unpackmodel.324   
  fi                                                                       unpackmodel.325   
fi                                                                         unpackmodel.326   
                                                                           unpackmodel.327   
echo "Portable Unified Model vn$VN unpacking started on `date`" > $LOG     unpackmodel.328   
echo >> $LOG                                                               unpackmodel.329   
echo >> $LOG                                                               unpackmodel.330   
                                                                           unpackmodel.331   
if test "$SKIP_QUESTIONS" = "false"; then                                  unpackmodel.332   
                                                                           unpackmodel.333   
echo "Stage 1 - Machine Type, Directory Structure, Mods and Paths" \       unpackmodel.334   
     >> $LOG                                                               unpackmodel.335   
echo "-----------------------------------------------------------" \       unpackmodel.336   
     >> $LOG                                                               unpackmodel.337   
echo >> $LOG                                                               unpackmodel.338   
                                                                           unpackmodel.339   
echo "--------------------------------------------------------"            unpackmodel.340   
echo " Step 1.1: Select Machine Type                          "            unpackmodel.341   
echo "--------------------------------------------------------"            unpackmodel.342   
echo                                                                       unpackmodel.343   
echo "Please select a platform from the list of supported"                 unpackmodel.344   
echo "platforms below: [$PLATFORM]"                                        unpackmodel.345   
echo                                                                       unpackmodel.346   
echo "1) Cray T3E (Met Office only)"                                       unpackmodel.347   
echo "2) T3E (Generic)"                                                    unpackmodel.348   
echo "3) Cray Parallel Vector Processor"                                   unpackmodel.349   
echo "4) Hewlett Packard Workstation"                                      unpackmodel.350   
echo "5) Dec Alpha Workstation"                                            unpackmodel.351   
echo "6) SGI Origin/Octane"                                                unpackmodel.352   
echo "7) Linux x86 using Fujitsu Fortran90 compiler"                       unpackmodel.353   
echo "8) Other"                                                            unpackmodel.354   
echo "x) Exit script"                                                      unpackmodel.355   
echo                                                                       unpackmodel.356   
                                                                           unpackmodel.357   
VALID=null                                                                 unpackmodel.358   
while test "$VALID" = "null"                                               unpackmodel.359   
do                                                                         unpackmodel.360   
  read ANSWER                                                              unpackmodel.361   
  ANSWER=${ANSWER:-$PLATFORM}                                              unpackmodel.362   
                                                                           unpackmodel.363   
  case $ANSWER in                                                          unpackmodel.364   
    [1-8] ) if test "$ANSWER" != "$PLATFORM" -a "$USE_CONFIG" = "true"     unpackmodel.365   
            then                                                           unpackmodel.366   
              echo "Platform has changed since last build"                 unpackmodel.367   
              echo "Cannot use defaults from $CONFIG"                      unpackmodel.368   
              echo "Removing $CONFIG"                                      unpackmodel.369   
              echo "OVERRULE: Defaults taken from $MACH_DEFS" >> $LOG      unpackmodel.370   
              rm $CONFIG                                                   unpackmodel.371   
            fi                                                             unpackmodel.372   
            if test ! -s $CONFIG; then                                     unpackmodel.373   
              $MACH_DEFS $ANSWER $CONFIG                                   unpackmodel.374   
            fi                                                             unpackmodel.375   
            VALID="true";;                                                 unpackmodel.376   
    X | x ) exit;;                                                         unpackmodel.377   
    *     ) echo "Invalid response"                                        unpackmodel.378   
            echo "Please re-enter your answer";;                           unpackmodel.379   
  esac                                                                     unpackmodel.380   
done                                                                       unpackmodel.381   
                                                                           unpackmodel.382   
cat > $CONFIG_TMP <<EOF                                                    unpackmodel.383   
PLATFORM=$ANSWER                                                           unpackmodel.384   
EOF                                                                        unpackmodel.385   
                                                                           unpackmodel.386   
UMMACHINE=`getvar UMMACHINE $CONFIG`                                       unpackmodel.387   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.388   
UMMACHINE=$UMMACHINE                                                       unpackmodel.389   
EOF                                                                        unpackmodel.390   
                                                                           unpackmodel.391   
echo "UM Machine set to $UMMACHINE" >> $LOG                                unpackmodel.392   
echo >> $LOG                                                               unpackmodel.393   
                                                                           unpackmodel.394   
# Get UM_SECTOR_SIZE and BUILDHOST. These are set values                   unpackmodel.395   
                                                                           unpackmodel.396   
UM_SECTOR_SIZE=`getvar UM_SECTOR_SIZE $CONFIG`                             unpackmodel.397   
BUILDHOST=`getvar BUILDHOST $CONFIG`                                       unpackmodel.398   
                                                                           unpackmodel.399   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.400   
UM_SECTOR_SIZE=$UM_SECTOR_SIZE                                             unpackmodel.401   
BUILDHOST=$BUILDHOST                                                       unpackmodel.402   
EOF                                                                        unpackmodel.403   
                                                                           unpackmodel.404   
if test "$UMMACHINE" != "METOCRAY"                                         unpackmodel.405   
then                                                                       unpackmodel.406   
                                                                           unpackmodel.407   
  echo "--------------------------------------------------------"          unpackmodel.408   
  echo " Step 1.2: Build Directory Structure                    "          unpackmodel.409   
  echo "--------------------------------------------------------"          unpackmodel.410   
  echo                                                                     unpackmodel.411   
                                                                           unpackmodel.412   
  # Set UM directories                                                     unpackmodel.413   
                                                                           unpackmodel.414   
  UM_HOME=`getvar UM_HOME $CONFIG`                                         unpackmodel.415   
  echo "Enter UM_HOME [$UM_HOME]"                                          unpackmodel.416   
  read ANSWER                                                              unpackmodel.417   
  ANSWER=`eval "echo $ANSWER"`                                             unpackmodel.418   
  UM_HOME=${ANSWER:-$UM_HOME}                                              unpackmodel.419   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.420   
UM_HOME=$UM_HOME                                                           unpackmodel.421   
EOF                                                                        unpackmodel.422   
                                                                           unpackmodel.423   
  if test ! -d $UM_HOME; then                                              unpackmodel.424   
    mkdir $UM_HOME                                                         unpackmodel.425   
  fi                                                                       unpackmodel.426   
                                                                           unpackmodel.427   
  echo "The UM home directory has been located at" >> $LOG                 unpackmodel.428   
  echo "$UM_HOME" >> $LOG                                                  unpackmodel.429   
  echo                                                                     unpackmodel.430   
                                                                           unpackmodel.431   
  UMDIR=`getvar UMDIR $CONFIG`                                             unpackmodel.432   
  UMDIR=`eval "echo $UMDIR"`                                               unpackmodel.433   
  echo "Enter UMDIR [$UMDIR]"                                              unpackmodel.434   
  read ANSWER                                                              unpackmodel.435   
  ANSWER=`eval "echo $ANSWER"`                                             unpackmodel.436   
  UMDIR=${ANSWER:-$UMDIR}                                                  unpackmodel.437   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.438   
UMDIR=$UMDIR                                                               unpackmodel.439   
EOF                                                                        unpackmodel.440   
  export UMDIR                                                             unpackmodel.441   
                                                                           unpackmodel.442   
  if test ! -d $UMDIR; then                                                unpackmodel.443   
    mkdir $UMDIR                                                           unpackmodel.444   
  fi                                                                       unpackmodel.445   
                                                                           unpackmodel.446   
  echo "The main UM directory has been located at" >> $LOG                 unpackmodel.447   
  echo "$UMDIR" >> $LOG                                                    unpackmodel.448   
  echo                                                                     unpackmodel.449   
                                                                           unpackmodel.450   
  UMTEST=`getvar UMTEST $CONFIG`                                           unpackmodel.451   
  UMTEST=`eval "echo $UMTEST"`                                             unpackmodel.452   
  echo "Enter UMTEST [$UMTEST]"                                            unpackmodel.453   
  read ANSWER                                                              unpackmodel.454   
  ANSWER=`eval "echo $ANSWER"`                                             unpackmodel.455   
  UMTEST=${ANSWER:-$UMTEST}                                                unpackmodel.456   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.457   
UMTEST=$UMTEST                                                             unpackmodel.458   
EOF                                                                        unpackmodel.459   
  export UMTEST                                                            unpackmodel.460   
                                                                           unpackmodel.461   
  if test ! -d $UMTEST; then                                               unpackmodel.462   
    mkdir $UMTEST                                                          unpackmodel.463   
  fi                                                                       unpackmodel.464   
                                                                           unpackmodel.465   
  echo "The UM test directory has been located at" >> $LOG                 unpackmodel.466   
  echo "$UMTEST" >> $LOG                                                   unpackmodel.467   
  echo                                                                     unpackmodel.468   
                                                                           unpackmodel.469   
  # Directories which will change for each user                            unpackmodel.470   
                                                                           unpackmodel.471   
  MY_UMHOME=`getvar MY_UMHOME $CONFIG`                                     unpackmodel.472   
  echo "Enter MY_UMHOME [$MY_UMHOME]"                                      unpackmodel.473   
  read ANSWER                                                              unpackmodel.474   
  MY_UMHOME=${ANSWER:-$MY_UMHOME}                                          unpackmodel.475   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.476   
MY_UMHOME=$MY_UMHOME                                                       unpackmodel.477   
EOF                                                                        unpackmodel.478   
                                                                           unpackmodel.479   
  echo "The user UM home directory has been located at" >> $LOG            unpackmodel.480   
  echo "$MY_UMHOME" >> $LOG                                                unpackmodel.481   
  echo                                                                     unpackmodel.482   
                                                                           unpackmodel.483   
  UM_TMP=`getvar UM_TMP $CONFIG`                                           unpackmodel.484   
  echo "Enter UM_TMP [$UM_TMP]"                                            unpackmodel.485   
  read ANSWER                                                              unpackmodel.486   
  UM_TMP=${ANSWER:-$UM_TMP}                                                unpackmodel.487   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.488   
UM_TMP=$UM_TMP                                                             unpackmodel.489   
EOF                                                                        unpackmodel.490   
                                                                           unpackmodel.491   
  echo "The UM temporary directory has been located at" >> $LOG            unpackmodel.492   
  echo "$UM_TMP" >> $LOG                                                   unpackmodel.493   
  echo                                                                     unpackmodel.494   
                                                                           unpackmodel.495   
  MY_OUTPUT=`getvar MY_OUTPUT $CONFIG`                                     unpackmodel.496   
  echo "Enter MY_OUTPUT [$MY_OUTPUT]"                                      unpackmodel.497   
  read ANSWER                                                              unpackmodel.498   
  MY_OUTPUT=${ANSWER:-$MY_OUTPUT}                                          unpackmodel.499   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.500   
MY_OUTPUT=$MY_OUTPUT                                                       unpackmodel.501   
EOF                                                                        unpackmodel.502   
                                                                           unpackmodel.503   
  echo "The user output directory has been located at" >> $LOG             unpackmodel.504   
  echo "$MY_OUTPUT" >> $LOG                                                unpackmodel.505   
  echo                                                                     unpackmodel.506   
                                                                           unpackmodel.507   
  if test ! -d $UMDIR/bin; then                                            unpackmodel.508   
    mkdir $UMDIR/bin                                                       unpackmodel.509   
  fi                                                                       unpackmodel.510   
                                                                           unpackmodel.511   
  echo "The UM bin directory is" >> $LOG                                   unpackmodel.512   
  echo "$UMDIR/bin" >> $LOG                                                unpackmodel.513   
  echo                                                                     unpackmodel.514   
  echo >> $LOG                                                             unpackmodel.515   
                                                                           unpackmodel.516   
  echo "--------------------------------------------------------"          unpackmodel.517   
  echo " Step 1.3: Script Modifications                         "          unpackmodel.518   
  echo "--------------------------------------------------------"          unpackmodel.519   
  echo                                                                     unpackmodel.520   
                                                                           unpackmodel.521   
  SCRMODS=`getvar SCRMODS $CONFIG`                                         unpackmodel.522   
  echo "Enter SCRMODS, the file containing any mods for the"               unpackmodel.523   
  echo "scripts [$SCRMODS]"                                                unpackmodel.524   
  read ANSWER                                                              unpackmodel.525   
  ANSWER=`eval "echo $ANSWER"`                                             unpackmodel.526   
  SCRMODS=${ANSWER:-$SCRMODS}                                              unpackmodel.527   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.528   
SCRMODS=$SCRMODS                                                           unpackmodel.529   
EOF                                                                        unpackmodel.530   
                                                                           unpackmodel.531   
  if test -z "$SCRMODS"; then                                              unpackmodel.532   
    echo "Not using script mods" >> $LOG                                   unpackmodel.533   
  else                                                                     unpackmodel.534   
    echo "Using script mods from file" >> $LOG                             unpackmodel.535   
    echo "$SCRMODS" >> $LOG                                                unpackmodel.536   
  fi                                                                       unpackmodel.537   
  echo >> $LOG                                                             unpackmodel.538   
  echo                                                                     unpackmodel.539   
                                                                           unpackmodel.540   
  echo "--------------------------------------------------------"          unpackmodel.541   
  echo " Step 1.4: Utility PATHs                                "          unpackmodel.542   
  echo "--------------------------------------------------------"          unpackmodel.543   
  echo                                                                     unpackmodel.544   
                                                                           unpackmodel.545   
  UM_AWK=`whence awk`                                                      unpackmodel.546   
  UM_SED=`whence sed`                                                      unpackmodel.547   
  UM_GREP=`whence grep`                                                    unpackmodel.548   
                                                                           unpackmodel.549   
  echo "Change the default location ($UM_AWK) of awk? [n]"                 unpackmodel.550   
  check_tf n                                                               unpackmodel.551   
  CHANGE_AWK=$ANSWER                                                       unpackmodel.552   
                                                                           unpackmodel.553   
  if test "$CHANGE_AWK" = "true"; then                                     unpackmodel.554   
    UM_AWK=`getvar UM_AWK $CONFIG`                                         unpackmodel.555   
    echo "Enter UM_AWK, the path and name of the awk utility"              unpackmodel.556   
    echo "[$UM_AWK]"                                                       unpackmodel.557   
    read ANSWER                                                            unpackmodel.558   
    ANSWER=`eval "echo $ANSWER"`                                           unpackmodel.559   
    UM_AWK=${ANSWER:-$UM_AWK}                                              unpackmodel.560   
  fi                                                                       unpackmodel.561   
                                                                           unpackmodel.562   
  echo "Change the default location ($UM_SED) of sed? [n]"                 unpackmodel.563   
  check_tf n                                                               unpackmodel.564   
  CHANGE_SED=$ANSWER                                                       unpackmodel.565   
                                                                           unpackmodel.566   
  if test "$CHANGE_SED" = "true"; then                                     unpackmodel.567   
    UM_SED=`getvar UM_SED $CONFIG`                                         unpackmodel.568   
    echo "Enter UM_SED, the path and name of the sed utility"              unpackmodel.569   
    echo "[$UM_SED]"                                                       unpackmodel.570   
    read ANSWER                                                            unpackmodel.571   
    ANSWER=`eval "echo $ANSWER"`                                           unpackmodel.572   
    UM_SED=${ANSWER:-$UM_SED}                                              unpackmodel.573   
  fi                                                                       unpackmodel.574   
                                                                           unpackmodel.575   
  echo "Change the default location ($UM_GREP) of grep? [n]"               unpackmodel.576   
  check_tf n                                                               unpackmodel.577   
  CHANGE_GREP=$ANSWER                                                      unpackmodel.578   
                                                                           unpackmodel.579   
  if test "$CHANGE_GREP" = "true"; then                                    unpackmodel.580   
    UM_GREP=`getvar UM_GREP $CONFIG`                                       unpackmodel.581   
    echo "Enter UM_GREP, the path and name of the grep utility"            unpackmodel.582   
    echo "[$UM_GREP]"                                                      unpackmodel.583   
    read ANSWER                                                            unpackmodel.584   
    ANSWER=`eval "echo $ANSWER"`                                           unpackmodel.585   
    UM_GREP=${ANSWER:-$UM_GREP}                                            unpackmodel.586   
  fi                                                                       unpackmodel.587   
                                                                           unpackmodel.588   
else                                                                       unpackmodel.589   
  UM_AWK=`whence awk`                                                      unpackmodel.590   
  UM_SED=`whence sed`                                                      unpackmodel.591   
  UM_GREP=`whence grep`                                                    unpackmodel.592   
fi                                                                         unpackmodel.593   
                                                                           unpackmodel.594   
echo "The awk utility is $UM_AWK " >> $LOG                                 unpackmodel.595   
echo "The sed utility is $UM_SED " >> $LOG                                 unpackmodel.596   
echo "The grep utility is $UM_GREP " >> $LOG                               unpackmodel.597   
echo >> $LOG                                                               unpackmodel.598   
                                                                           unpackmodel.599   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.600   
UM_AWK=$UM_AWK                                                             unpackmodel.601   
UM_SED=$UM_SED                                                             unpackmodel.602   
UM_GREP=$UM_GREP                                                           unpackmodel.603   
EOF                                                                        unpackmodel.604   
                                                                           unpackmodel.605   
#=======================================================================   unpackmodel.606   
                                                                           unpackmodel.607   
echo "Stage 2 - Compiler Options / Software Management" >> $LOG            unpackmodel.608   
echo "------------------------------------------------" >> $LOG            unpackmodel.609   
echo >> $LOG                                                               unpackmodel.610   
                                                                           unpackmodel.611   
echo "--------------------------------------------------------"            unpackmodel.612   
echo " Step 2.1: Select Number of Parallel Compilations       "            unpackmodel.613   
echo "--------------------------------------------------------"            unpackmodel.614   
echo                                                                       unpackmodel.615   
                                                                           unpackmodel.616   
NPROC=`getvar NPROC $CONFIG`                                               unpackmodel.617   
echo "Please select the number of compilations that can run"               unpackmodel.618   
echo "in parallel on your machine [$NPROC]"                                unpackmodel.619   
read ANSWER                                                                unpackmodel.620   
NPROC=${ANSWER:-$NPROC}                                                    unpackmodel.621   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.622   
NPROC=$NPROC                                                               unpackmodel.623   
EOF                                                                        unpackmodel.624   
                                                                           unpackmodel.625   
echo "The number of parallel compilations is set to $NPROC" >> $LOG        unpackmodel.626   
echo >> $LOG                                                               unpackmodel.627   
echo                                                                       unpackmodel.628   
                                                                           unpackmodel.629   
echo "--------------------------------------------------------"            unpackmodel.630   
echo " Step 2.2: Compilers & Options                          "            unpackmodel.631   
echo "--------------------------------------------------------"            unpackmodel.632   
echo                                                                       unpackmodel.633   
                                                                           unpackmodel.634   
# C compiler                                                               unpackmodel.635   
                                                                           unpackmodel.636   
CCOM_CMD=`getvar CCOM_CMD $CONFIG`                                         unpackmodel.637   
echo "Enter the name of your C compiler [$CCOM_CMD]" | tee -a $LOG         unpackmodel.638   
read ANSWER                                                                unpackmodel.639   
CCOM_CMD=${ANSWER:-$CCOM_CMD}                                              unpackmodel.640   
echo "Answer: $CCOM_CMD" >> $LOG                                           unpackmodel.641   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.642   
CCOM_CMD=$CCOM_CMD                                                         unpackmodel.643   
EOF                                                                        unpackmodel.644   
                                                                           unpackmodel.645   
CCOM_OPTS=`getvar CCOM_OPTS $CONFIG`                                       unpackmodel.646   
echo "Enter the C compiler options [$CCOM_OPTS]" | tee -a $LOG             unpackmodel.647   
read "ANSWER"                                                              unpackmodel.648   
CCOM_OPTS="${ANSWER:-$CCOM_OPTS}"                                          unpackmodel.649   
echo "Answer: $CCOM_OPTS" >> $LOG                                          unpackmodel.650   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.651   
CCOM_OPTS=$CCOM_OPTS                                                       unpackmodel.652   
EOF                                                                        unpackmodel.653   
                                                                           unpackmodel.654   
CCOM_OPTIM=`getvar CCOM_OPTIM $CONFIG`                                     unpackmodel.655   
echo "Enter the C compiler optimizations [$CCOM_OPTIM]" | tee -a $LOG      unpackmodel.656   
read "ANSWER"                                                              unpackmodel.657   
CCOM_OPTIM="${ANSWER:-$CCOM_OPTIM}"                                        unpackmodel.658   
echo "Answer: $CCOM_OPTIM" >> $LOG                                         unpackmodel.659   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.660   
CCOM_OPTIM=$CCOM_OPTIM                                                     unpackmodel.661   
EOF                                                                        unpackmodel.662   
                                                                           unpackmodel.663   
# Fortran compiler                                                         unpackmodel.664   
                                                                           unpackmodel.665   
FCOM_CMD=`getvar FCOM_CMD $CONFIG`                                         unpackmodel.666   
echo "Enter the name of your Fortran compiler [$FCOM_CMD]"  | \            unpackmodel.667   
  tee -a $LOG                                                              unpackmodel.668   
read ANSWER                                                                unpackmodel.669   
FCOM_CMD=${ANSWER:-$FCOM_CMD}                                              unpackmodel.670   
echo "Answer: $FCOM_CMD" >> $LOG                                           unpackmodel.671   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.672   
FCOM_CMD=$FCOM_CMD                                                         unpackmodel.673   
EOF                                                                        unpackmodel.674   
                                                                           unpackmodel.675   
FCOM_OPTS=`getvar FCOM_OPTS $CONFIG`                                       unpackmodel.676   
echo "Enter the Fortran compiler options [$FCOM_OPTS]" | tee -a $LOG       unpackmodel.677   
read "ANSWER"                                                              unpackmodel.678   
FCOM_OPTS="${ANSWER:-$FCOM_OPTS}"                                          unpackmodel.679   
echo "Answer: $FCOM_OPTS" >> $LOG                                          unpackmodel.680   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.681   
FCOM_OPTS=$FCOM_OPTS                                                       unpackmodel.682   
EOF                                                                        unpackmodel.683   
                                                                           unpackmodel.684   
FCOM_OPTIM=`getvar FCOM_OPTIM $CONFIG`                                     unpackmodel.685   
echo "Enter the Fortran compiler optimizations [$FCOM_OPTIM]" | \          unpackmodel.686   
  tee -a $LOG                                                              unpackmodel.687   
read "ANSWER"                                                              unpackmodel.688   
FCOM_OPTIM="${ANSWER:-$FCOM_OPTIM}"                                        unpackmodel.689   
echo "Answer: $FCOM_OPTIM" >> $LOG                                         unpackmodel.690   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.691   
FCOM_OPTIM=$FCOM_OPTIM                                                     unpackmodel.692   
EOF                                                                        unpackmodel.693   
                                                                           unpackmodel.694   
# Linker                                                                   unpackmodel.695   
                                                                           unpackmodel.696   
LCOM_CMD=`getvar LCOM_CMD $CONFIG`                                         unpackmodel.697   
echo "Enter the name of your linker [$LCOM_CMD]" | tee -a $LOG             unpackmodel.698   
read ANSWER                                                                unpackmodel.699   
LCOM_CMD=${ANSWER:-$LCOM_CMD}                                              unpackmodel.700   
echo "Answer: $LCOM_CMD" >> $LOG                                           unpackmodel.701   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.702   
LCOM_CMD=$LCOM_CMD                                                         unpackmodel.703   
EOF                                                                        unpackmodel.704   
                                                                           unpackmodel.705   
LCOM_OPTS=`getvar LCOM_OPTS $CONFIG`                                       unpackmodel.706   
echo "Enter the linker options [$LCOM_OPTS]" | tee -a $LOG                 unpackmodel.707   
read "ANSWER"                                                              unpackmodel.708   
LCOM_OPTS="${ANSWER:-$LCOM_OPTS}"                                          unpackmodel.709   
echo "Answer: $LCOM_OPTS" >> $LOG                                          unpackmodel.710   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.711   
LCOM_OPTS=$LCOM_OPTS                                                       unpackmodel.712   
EOF                                                                        unpackmodel.713   
                                                                           unpackmodel.714   
LCOM_PATH=`getvar LCOM_PATH $CONFIG`                                       unpackmodel.715   
echo "Enter any library path options [$LCOM_PATH]" | tee -a $LOG           unpackmodel.716   
read "ANSWER"                                                              unpackmodel.717   
LCOM_PATH="${ANSWER:-$LCOM_PATH}"                                          unpackmodel.718   
echo "Answer: $LCOM_PATH" >> $LOG                                          unpackmodel.719   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.720   
LCOM_PATH=$LCOM_PATH                                                       unpackmodel.721   
EOF                                                                        unpackmodel.722   
                                                                           unpackmodel.723   
LCOM_LIBS=`getvar LCOM_LIBS $CONFIG`                                       unpackmodel.724   
echo "Enter any library options [$LCOM_LIBS]" | tee -a $LOG                unpackmodel.725   
read "ANSWER"                                                              unpackmodel.726   
LCOM_LIBS="${ANSWER:-$LCOM_LIBS}"                                          unpackmodel.727   
echo "Answer: $LCOM_LIBS" >> $LOG                                          unpackmodel.728   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.729   
LCOM_LIBS=$LCOM_LIBS                                                       unpackmodel.730   
EOF                                                                        unpackmodel.731   
                                                                           unpackmodel.732   
COM_SPECIFIC=`getvar COM_SPECIFIC $CONFIG`                                 unpackmodel.733   
echo "Enter the file (with full path) containing any compile" | \          unpackmodel.734   
  tee -a $LOG                                                              unpackmodel.735   
echo "options for specific decks [$COM_SPECIFIC]" | tee -a $LOG            unpackmodel.736   
read ANSWER                                                                unpackmodel.737   
COM_SPECIFIC=${ANSWER:-`eval "echo $COM_SPECIFIC"`}                        unpackmodel.738   
echo "Answer: $COM_SPECIFIC" >> $LOG                                       unpackmodel.739   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.740   
COM_SPECIFIC=$COM_SPECIFIC                                                 unpackmodel.741   
EOF                                                                        unpackmodel.742   
                                                                           unpackmodel.743   
echo >> $LOG                                                               unpackmodel.744   
echo                                                                       unpackmodel.745   
                                                                           unpackmodel.746   
echo "--------------------------------------------------------"            unpackmodel.747   
echo " Step 2.3: Fortran/C Interface and Wordlength           "            unpackmodel.748   
echo "--------------------------------------------------------"            unpackmodel.749   
echo                                                                       unpackmodel.750   
                                                                           unpackmodel.751   
echo "The interface and wordlength can be calculated, or the"              unpackmodel.752   
echo "defaults can be used. Do the calculations? [y]"                      unpackmodel.753   
check_tf y                                                                 unpackmodel.754   
                                                                           unpackmodel.755   
if test "$ANSWER" = "true"; then                                           unpackmodel.756   
  echo "Calculating...please wait"                                         unpackmodel.757   
  echo                                                                     unpackmodel.758   
                                                                           unpackmodel.759   
  FCTEST=`eval "echo $FCTEST"`                                             unpackmodel.760   
  cd $FCTEST                                                               unpackmodel.761   
  make clean 2>/dev/null                                                   unpackmodel.762   
  make > $FCTEST_TMP                                                       unpackmodel.763   
  CC=$?                                                                    unpackmodel.764   
  testcc $CC "running fc_test"                                             unpackmodel.765   
                                                                           unpackmodel.766   
  FC_LINK=`getvar FC_LINK $FCTEST_TMP`                                     unpackmodel.767   
  FRL8=`getvar FRL8 $FCTEST_TMP`                                           unpackmodel.768   
  INTLL=`getvar INTLL $FCTEST_TMP`                                         unpackmodel.769   
  BIGEND=`getvar BIGEND $FCTEST_TMP`                                       unpackmodel.770   
  FRL_SIZE=`getvar FRL_SIZE $FCTEST_TMP`                                   unpackmodel.771   
  cd - 1>/dev/null 2>&1                                                    unpackmodel.772   
                                                                           unpackmodel.773   
  if test "$FRL8" = "null"; then                                           unpackmodel.774   
    FRL8=`getvar FRL8 $CONFIG`                                             unpackmodel.775   
  fi                                                                       unpackmodel.776   
  if test "$INTLL" = "null"; then                                          unpackmodel.777   
    INTLL=`getvar INTLL $CONFIG`                                           unpackmodel.778   
  fi                                                                       unpackmodel.779   
  if test "$BIGEND" = "null"; then                                         unpackmodel.780   
    BIGEND=`getvar BIGEND $CONFIG`                                         unpackmodel.781   
  fi                                                                       unpackmodel.782   
  if test "$FRL_SIZ" = "null"; then                                        unpackmodel.783   
    FRL_SIZE=`getvar FRL_SIZE $CONFIG`                                     unpackmodel.784   
  fi                                                                       unpackmodel.785   
  rm $FCTEST_TMP                                                           unpackmodel.786   
                                                                           unpackmodel.787   
else                                                                       unpackmodel.788   
  FC_LINK=`getvar FC_LINK $CONFIG`                                         unpackmodel.789   
  FRL8=`getvar FRL8 $CONFIG`                                               unpackmodel.790   
  INTLL=`getvar INTLL $CONFIG`                                             unpackmodel.791   
  BIGEND=`getvar BIGEND $CONFIG`                                           unpackmodel.792   
  FRL_SIZE=`getvar FRL_SIZE $CONFIG`                                       unpackmodel.793   
fi                                                                         unpackmodel.794   
                                                                           unpackmodel.795   
if test "$FC_LINK" = "null"; then                                          unpackmodel.796   
  testcc 1 "setting FC_LINK"                                               unpackmodel.797   
fi                                                                         unpackmodel.798   
if test "$FRL8" = "null"; then                                             unpackmodel.799   
  testcc 1 "setting FRL8"                                                  unpackmodel.800   
fi                                                                         unpackmodel.801   
if test "$INTLL" = "null"; then                                            unpackmodel.802   
  testcc 1 "setting INTLL"                                                 unpackmodel.803   
fi                                                                         unpackmodel.804   
if test "$BIGEND" = "null"; then                                           unpackmodel.805   
  testcc 1 "setting BIGEND"                                                unpackmodel.806   
fi                                                                         unpackmodel.807   
if test "$FRL_SIZE" = "null"; then                                         unpackmodel.808   
  testcc 1 "setting FRL_SIZE"                                              unpackmodel.809   
fi                                                                         unpackmodel.810   
                                                                           unpackmodel.811   
case "$FC_LINK" in                                                         unpackmodel.812   
  "C_UP"    ) FC_PHRASE="upper case";;                                     unpackmodel.813   
  "C_LOW"   ) FC_PHRASE="lower case";;                                     unpackmodel.814   
  "C_LOW_U" ) FC_PHRASE="lower case with trailing underscore";;            unpackmodel.815   
esac                                                                       unpackmodel.816   
                                                                           unpackmodel.817   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.818   
FC_LINK=$FC_LINK                                                           unpackmodel.819   
EOF                                                                        unpackmodel.820   
                                                                           unpackmodel.821   
case "$FRL8" in                                                            unpackmodel.822   
  "true"  ) FRL8_PHRASE="double";;                                         unpackmodel.823   
  "false" ) FRL8_PHRASE="float";;                                          unpackmodel.824   
esac                                                                       unpackmodel.825   
                                                                           unpackmodel.826   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.827   
FRL8=$FRL8                                                                 unpackmodel.828   
EOF                                                                        unpackmodel.829   
                                                                           unpackmodel.830   
if test "$FRL8" = "true"; then                                             unpackmodel.831   
  case "$INTLL" in                                                         unpackmodel.832   
    "true"  ) INTLL_PHRASE="long long";;                                   unpackmodel.833   
    "false" ) INTLL_PHRASE="long";;                                        unpackmodel.834   
  esac                                                                     unpackmodel.835   
else                                                                       unpackmodel.836   
  INTLL_PHRASE="int"                                                       unpackmodel.837   
fi                                                                         unpackmodel.838   
                                                                           unpackmodel.839   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.840   
INTLL=$INTLL                                                               unpackmodel.841   
EOF                                                                        unpackmodel.842   
                                                                           unpackmodel.843   
case "$BIGEND" in                                                          unpackmodel.844   
  "true"  ) BIGEND_PHRASE="big-endian";;                                   unpackmodel.845   
  "false" ) BIGEND_PHRASE="little-endian";;                                unpackmodel.846   
esac                                                                       unpackmodel.847   
                                                                           unpackmodel.848   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.849   
BIGEND=$BIGEND                                                             unpackmodel.850   
EOF                                                                        unpackmodel.851   
                                                                           unpackmodel.852   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.853   
FRL_SIZE=$FRL_SIZE                                                         unpackmodel.854   
EOF                                                                        unpackmodel.855   
                                                                           unpackmodel.856   
echo "Using the chosen compilers and options, on this platform:" >> $LOG   unpackmodel.857   
echo "(a) Fortran will interface with C routines which have" >> $LOG       unpackmodel.858   
echo "    names in $FC_PHRASE" >> $LOG                                     unpackmodel.859   
echo "(b) A C $FRL8_PHRASE has equivalent wordlength to a" >> $LOG         unpackmodel.860   
echo "    Fortran real" >> $LOG                                            unpackmodel.861   
echo "(c) A C $INTLL_PHRASE has equivalent wordlength to a" >> $LOG        unpackmodel.862   
echo "    Fortran integer" >> $LOG                                         unpackmodel.863   
echo "(d) The data representation is $BIGEND_PHRASE" >> $LOG               unpackmodel.864   
echo "(e) Fortran REAL's are $FRL_SIZE bits long" >> $LOG                  unpackmodel.865   
echo >> $LOG                                                               unpackmodel.866   
echo                                                                       unpackmodel.867   
                                                                           unpackmodel.868   
ANSI_C=`getvar ANSI_C $CONFIG`                                             unpackmodel.869   
if test "$BIGEND" = "false"; then                                          unpackmodel.870   
                                                                           unpackmodel.871   
  echo "This platform requires data to be little-endian" | tee -a $LOG     unpackmodel.872   
  echo "The bigend utility is required" | tee -a $LOG                      unpackmodel.873   
  echo "Enter the C compiler flag for ANSI compliance [$ANSI_C]" \         unpackmodel.874   
        | tee -a $LOG                                                      unpackmodel.875   
                                                                           unpackmodel.876   
  read "ANSWER"                                                            unpackmodel.877   
  ANSI_C="${ANSWER:-$ANSI_C}"                                              unpackmodel.878   
  echo "Answer: $ANSI_C" >> $LOG                                           unpackmodel.879   
                                                                           unpackmodel.880   
  BIGEND_UTIL=`eval "echo $BIGEND_UTIL"`                                   unpackmodel.881   
  cd $BIGEND_UTIL                                                          unpackmodel.882   
  echo "Compiling the bigend utility...please wait"                        unpackmodel.883   
  $CCOM_CMD $ANSI_C bigend.c -o bigend                                     unpackmodel.884   
  CC=$?                                                                    unpackmodel.885   
  testcc $CC "compiling bigend"                                            unpackmodel.886   
                                                                           unpackmodel.887   
  echo "Linking the bigend executable to \$UMDIR/bin" | \                  unpackmodel.888   
        tee -a $LOG                                                        unpackmodel.889   
  ln -sf $BIGEND_UTIL/bigend $UMDIR/bin 2>/dev/null                        unpackmodel.890   
  cd - 1>/dev/null 2>&1                                                    unpackmodel.891   
  echo                                                                     unpackmodel.892   
                                                                           unpackmodel.893   
fi                                                                         unpackmodel.894   
                                                                           unpackmodel.895   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.896   
ANSI_C=$ANSI_C                                                             unpackmodel.897   
EOF                                                                        unpackmodel.898   
                                                                           unpackmodel.899   
echo "--------------------------------------------------------"            unpackmodel.900   
echo " Step 2.4: Nupdate Software Manager                     "            unpackmodel.901   
echo "--------------------------------------------------------"            unpackmodel.902   
echo                                                                       unpackmodel.903   
                                                                           unpackmodel.904   
echo "There are 2 flavours of nupdate:-"                                   unpackmodel.905   
echo "(1) Cray - recommended for Cray"                                     unpackmodel.906   
echo "(2) Portable - not tested on Cray"                                   unpackmodel.907   
echo "You should use one or the other"                                     unpackmodel.908   
                                                                           unpackmodel.909   
USE_CRAY_NUPDATE=`getvar USE_CRAY_NUPDATE $CONFIG`                         unpackmodel.910   
echo "Use Cray nupdate? [$USE_CRAY_NUPDATE]" | tee -a $LOG                 unpackmodel.911   
check_tf $USE_CRAY_NUPDATE                                                 unpackmodel.912   
USE_CRAY_NUPDATE=$ANSWER                                                   unpackmodel.913   
echo "Answer: $USE_CRAY_NUPDATE" >> $LOG                                   unpackmodel.914   
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.915   
USE_CRAY_NUPDATE=$USE_CRAY_NUPDATE                                         unpackmodel.916   
EOF                                                                        unpackmodel.917   
                                                                           unpackmodel.918   
echo                                                                       unpackmodel.919   
                                                                           unpackmodel.920   
if test "$USE_CRAY_NUPDATE" = "false"; then                                unpackmodel.921   
  UPDATEVN=`getvar UPDATEVN $CONFIG`                                       unpackmodel.922   
  echo "The supplied version of portable nupdate is $UPDATE_DEF"           unpackmodel.923   
  echo "If you wish to use another version, enter it here [$UPDATEVN]"     unpackmodel.924   
  read ANSWER                                                              unpackmodel.925   
  UPDATEVN=${ANSWER:-$UPDATEVN}                                            unpackmodel.926   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.927   
UPDATEVN=$UPDATEVN                                                         unpackmodel.928   
EOF                                                                        unpackmodel.929   
                                                                           unpackmodel.930   
  echo                                                                     unpackmodel.931   
                                                                           unpackmodel.932   
  UPDATEDIR=`getvar UPDATEDIR $CONFIG`                                     unpackmodel.933   
  echo "Enter the directory containing the top level nupdate"              unpackmodel.934   
  echo "directory [$UPDATEDIR]"                                            unpackmodel.935   
  read ANSWER                                                              unpackmodel.936   
  ANSWER=`eval "echo $ANSWER"`                                             unpackmodel.937   
  UPDATEDIR=${ANSWER:-`eval "echo $UPDATEDIR"`}                            unpackmodel.938   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.939   
UPDATEDIR=$UPDATEDIR                                                       unpackmodel.940   
EOF                                                                        unpackmodel.941   
                                                                           unpackmodel.942   
  echo                                                                     unpackmodel.943   
else                                                                       unpackmodel.944   
  UPDATEDIR=`getvar UPDATEDIR $CONFIG`                                     unpackmodel.945   
  echo "Enter the directory containing the nupdate"                        unpackmodel.946   
  echo "executable [$UPDATEDIR]"                                           unpackmodel.947   
  read ANSWER                                                              unpackmodel.948   
  ANSWER=`eval "echo $ANSWER"`                                             unpackmodel.949   
  UPDATEDIR=${ANSWER:-`eval "echo $UPDATEDIR"`}                            unpackmodel.950   
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.951   
UPDATEDIR=$UPDATEDIR                                                       unpackmodel.952   
EOF                                                                        unpackmodel.953   
  if test ! -z "$UPDATEDIR"; then                                          unpackmodel.954   
    if test "$UPDATEDIR" != "$UMDIR/bin"; then                             unpackmodel.955   
      echo "Linking the nupdate executable to \$UMDIR/bin" | \             unpackmodel.956   
        tee -a $LOG                                                        unpackmodel.957   
      ln -sf $UPDATEDIR/nupdate $UMDIR/bin 2>/dev/null                     unpackmodel.958   
    fi                                                                     unpackmodel.959   
  fi                                                                       unpackmodel.960   
fi                                                                         unpackmodel.961   
echo >> $LOG                                                               unpackmodel.962   
echo                                                                       unpackmodel.963   
                                                                           unpackmodel.964   
if test "$UMMACHINE" != "METOCRAY"; then                                   unpackmodel.965   
                                                                           unpackmodel.966   
  whence banner 1>/dev/null 2>&1                                           unpackmodel.967   
  CC=$?                                                                    unpackmodel.968   
                                                                           unpackmodel.969   
  if test $CC -ne 0; then                                                  unpackmodel.970   
                                                                           unpackmodel.971   
    echo "--------------------------------------------------------"        unpackmodel.972   
    echo " Step 2.5: Banner Command                               "        unpackmodel.973   
    echo "--------------------------------------------------------"        unpackmodel.974   
    echo                                                                   unpackmodel.975   
                                                                           unpackmodel.976   
    echo "The banner command is not available on this platform"            unpackmodel.977   
    echo "Please wait whilst the figlet utility is compiled"               unpackmodel.978   
                                                                           unpackmodel.979   
    FIGLET=`eval "echo $FIGLET"`                                           unpackmodel.980   
    cd $FIGLET                                                             unpackmodel.981   
    FIGLET_UTIL=`eval "echo $FIGLET_UTIL"`                                 unpackmodel.982   
    export FIGLET_UTIL                                                     unpackmodel.983   
    make clean 2>/dev/null                                                 unpackmodel.984   
    make install                                                           unpackmodel.985   
    CC=$?                                                                  unpackmodel.986   
    testcc $CC "compiling figlet"                                          unpackmodel.987   
    cd -                                                                   unpackmodel.988   
                                                                           unpackmodel.989   
    echo "Linking the figlet executable to \$UMDIR/bin/banner" | \         unpackmodel.990   
        tee -a $LOG                                                        unpackmodel.991   
    echo >> $LOG                                                           unpackmodel.992   
    ln -sf $FIGLET_UTIL/figlet $UMDIR/bin/banner 2>/dev/null               unpackmodel.993   
    testcc $CC "linking figlet"                                            unpackmodel.994   
  fi                                                                       unpackmodel.995   
fi                                                                         unpackmodel.996   
                                                                           unpackmodel.997   
#=======================================================================   unpackmodel.998   
                                                                           unpackmodel.999   
echo "Stage 3 - Platform Definitions" >> $LOG                              unpackmodel.1000  
echo "------------------------------" >> $LOG                              unpackmodel.1001  
echo >> $LOG                                                               unpackmodel.1002  
                                                                           unpackmodel.1003  
echo "--------------------------------------------------------"            unpackmodel.1004  
echo " Step 3.1: Execution Mode                               "            unpackmodel.1005  
echo "--------------------------------------------------------"            unpackmodel.1006  
echo                                                                       unpackmodel.1007  
                                                                           unpackmodel.1008  
MPP=`getvar MPP $CONFIG`                                                   unpackmodel.1009  
echo "Build the MPP code? [$MPP]" | tee -a $LOG                            unpackmodel.1010  
check_tf $MPP                                                              unpackmodel.1011  
MPP=$ANSWER                                                                unpackmodel.1012  
MPPRECON=$MPP                                                              unpackmodel.1013  
echo "Answer: $MPP" >> $LOG                                                unpackmodel.1014  
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.1015  
MPP=$MPP                                                                   unpackmodel.1016  
MPPRECON=$MPPRECON                                                         unpackmodel.1017  
EOF                                                                        unpackmodel.1018  
                                                                           unpackmodel.1019  
echo                                                                       unpackmodel.1020  
                                                                           unpackmodel.1021  
BLDNOMPP=`getvar BLDNOMPP $CONFIG`                                         unpackmodel.1022  
echo "Build the non-MPP code? [$BLDNOMPP]" | tee -a $LOG                   unpackmodel.1023  
check_tf $BLDNOMPP                                                         unpackmodel.1024  
BLDNOMPP=$ANSWER                                                           unpackmodel.1025  
echo "Answer: $BLDNOMPP" >> $LOG                                           unpackmodel.1026  
  cat >> $CONFIG_TMP <<EOF                                                 unpackmodel.1027  
BLDNOMPP=$BLDNOMPP                                                         unpackmodel.1028  
EOF                                                                        unpackmodel.1029  
                                                                           unpackmodel.1030  
echo                                                                       unpackmodel.1031  
echo >> $LOG                                                               unpackmodel.1032  
                                                                           unpackmodel.1033  
echo "--------------------------------------------------------"            unpackmodel.1034  
echo " Step 3.2: Platform questions for machine OTHER         "            unpackmodel.1035  
echo "--------------------------------------------------------"            unpackmodel.1036  
echo                                                                       unpackmodel.1037  
                                                                           unpackmodel.1038  
CRAY=`getvar CRAY $CONFIG`                                                 unpackmodel.1039  
if test "$UMMACHINE" = "OTHER"; then                                       unpackmodel.1040  
  echo "Is this machine a CRAY supercomputer? [$CRAY]" | tee -a $LOG       unpackmodel.1041  
  check_tf $CRAY                                                           unpackmodel.1042  
  CRAY=$ANSWER                                                             unpackmodel.1043  
  echo "Answer: $CRAY" >> $LOG                                             unpackmodel.1044  
fi                                                                         unpackmodel.1045  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1046  
CRAY=$CRAY                                                                 unpackmodel.1047  
EOF                                                                        unpackmodel.1048  
                                                                           unpackmodel.1049  
T3E=`getvar T3E $CONFIG`                                                   unpackmodel.1050  
if test "$UMMACHINE" = "OTHER"; then                                       unpackmodel.1051  
  echo "Is this machine a T3E? [$T3E]" | tee -a $LOG                       unpackmodel.1052  
  check_tf $T3E                                                            unpackmodel.1053  
  T3E=$ANSWER                                                              unpackmodel.1054  
  echo "Answer: $T3E" >> $LOG                                              unpackmodel.1055  
fi                                                                         unpackmodel.1056  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1057  
T3E=$T3E                                                                   unpackmodel.1058  
EOF                                                                        unpackmodel.1059  
                                                                           unpackmodel.1060  
T3D=`getvar T3D $CONFIG`                                                   unpackmodel.1061  
if test "$UMMACHINE" = "OTHER"; then                                       unpackmodel.1062  
  echo "Is this machine a T3D? [$T3D]" | tee -a $LOG                       unpackmodel.1063  
  check_tf $T3D                                                            unpackmodel.1064  
  T3D=$ANSWER                                                              unpackmodel.1065  
  echo "Answer: $T3D" >> $LOG                                              unpackmodel.1066  
fi                                                                         unpackmodel.1067  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1068  
T3D=$T3D                                                                   unpackmodel.1069  
EOF                                                                        unpackmodel.1070  
                                                                           unpackmodel.1071  
FUJITSU=`getvar FUJITSU $CONFIG`                                           unpackmodel.1072  
if test "$UMMACHINE" = "OTHER"; then                                       unpackmodel.1073  
  echo "Is this machine a Fujitsu VPP? [$FUJITSU]" | tee -a $LOG           unpackmodel.1074  
  check_tf $FUJITSU                                                        unpackmodel.1075  
  FUJITSU=$ANSWER                                                          unpackmodel.1076  
  echo "Answer: $FUJITSU" >> $LOG                                          unpackmodel.1077  
  echo                                                                     unpackmodel.1078  
  echo >> $LOG                                                             unpackmodel.1079  
fi                                                                         unpackmodel.1080  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1081  
FUJITSU=$FUJITSU                                                           unpackmodel.1082  
EOF                                                                        unpackmodel.1083  
                                                                           unpackmodel.1084  
SGI=`getvar SGI $CONFIG`                                                   unpackmodel.1085  
if test "$UMMACHINE" = "OTHER"; then                                       unpackmodel.1086  
  echo "Is this machine a SGI Origin? [$SGI]" | tee -a $LOG                unpackmodel.1087  
  check_tf $SGI                                                            unpackmodel.1088  
  SGI=$ANSWER                                                              unpackmodel.1089  
  echo "Answer: $SGI" >> $LOG                                              unpackmodel.1090  
  echo                                                                     unpackmodel.1091  
  echo >> $LOG                                                             unpackmodel.1092  
fi                                                                         unpackmodel.1093  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1094  
SGI=$SGI                                                                   unpackmodel.1095  
EOF                                                                        unpackmodel.1096  
                                                                           unpackmodel.1097  
SUN=`getvar SUN $CONFIG`                                                   unpackmodel.1098  
if test "$UMMACHINE" = "OTHER"; then                                       unpackmodel.1099  
  echo "Is this machine a Sun? [$SUN]" | tee -a $LOG                       unpackmodel.1100  
  check_tf $SUN                                                            unpackmodel.1101  
  SUN=$ANSWER                                                              unpackmodel.1102  
  echo "Answer: $SUN" >> $LOG                                              unpackmodel.1103  
  echo                                                                     unpackmodel.1104  
  echo >> $LOG                                                             unpackmodel.1105  
fi                                                                         unpackmodel.1106  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1107  
SUN=$SUN                                                                   unpackmodel.1108  
EOF                                                                        unpackmodel.1109  
                                                                           unpackmodel.1110  
LINUX=`getvar LINUX $CONFIG`                                               unpackmodel.1111  
if test "$UMMACHINE" = "OTHER"; then                                       unpackmodel.1112  
  echo "Is this machine an x86 Linux? [$LINUX]" | tee -a $LOG              unpackmodel.1113  
  check_tf $LINUX                                                          unpackmodel.1114  
  LINUX=$ANSWER                                                            unpackmodel.1115  
  echo "Answer: $LINUX" >> $LOG                                            unpackmodel.1116  
  echo                                                                     unpackmodel.1117  
  echo >> $LOG                                                             unpackmodel.1118  
fi                                                                         unpackmodel.1119  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1120  
LINUX=$LINUX                                                               unpackmodel.1121  
EOF                                                                        unpackmodel.1122  
                                                                           unpackmodel.1123  
echo "--------------------------------------------------------"            unpackmodel.1124  
echo " Step 3.3: Platform specifics (T3E & MPP machines only) "            unpackmodel.1125  
echo "--------------------------------------------------------"            unpackmodel.1126  
echo                                                                       unpackmodel.1127  
                                                                           unpackmodel.1128  
VECTLIB=`getvar VECTLIB $CONFIG`                                           unpackmodel.1129  
if test "$T3E" = "true"; then                                              unpackmodel.1130  
  VECTLIBNAME=_vect                                                        unpackmodel.1131  
  echo "Some Cray T3E machines have a fast vector library" | tee -a $LOG   unpackmodel.1132  
  echo "called lib${VECTLIBNAME}.a" | tee -a $LOG                          unpackmodel.1133  
  echo "Would you like to use this library? [$VECTLIB]" | tee -a $LOG      unpackmodel.1134  
  check_tf $VECTLIB                                                        unpackmodel.1135  
  VECTLIB=$ANSWER                                                          unpackmodel.1136  
  echo "Answer: $VECTLIB" >> $LOG                                          unpackmodel.1137  
  echo                                                                     unpackmodel.1138  
  echo >> $LOG                                                             unpackmodel.1139  
                                                                           unpackmodel.1140  
  if test "$VECTLIB" = "true"; then                                        unpackmodel.1141  
                                                                           unpackmodel.1142  
    # Test for vector library in LCOM_LIBS and add if necessary            unpackmodel.1143  
    ADDLIB=`echo $LCOM_LIBS | grep $VECTLIBNAME`                           unpackmodel.1144  
    if test -z "$ADDLIB"; then                                             unpackmodel.1145  
      echo "The fast vector library is not in the list of libraries"       unpackmodel.1146  
      echo "which will be passed to the loader"                            unpackmodel.1147  
      echo "Adding it to the list..."                                      unpackmodel.1148  
      echo                                                                 unpackmodel.1149  
      sed "s/LCOM_LIBS=/LCOM_LIBS=-l$VECTLIBNAME /" $CONFIG_TMP > \        unpackmodel.1150  
        $TMPFILE                                                           unpackmodel.1151  
      mv $TMPFILE $CONFIG_TMP                                              unpackmodel.1152  
      LCOM_LIBS=`getvar LCOM_LIBS $CONFIG_TMP`                             unpackmodel.1153  
      echo "LCOM_LIBS updated to $LCOM_LIBS" >> $LOG                       unpackmodel.1154  
    fi                                                                     unpackmodel.1155  
                                                                           unpackmodel.1156  
    # Add extra library path if required                                   unpackmodel.1157  
    echo "Please enter the pathname (no -L) of lib${VECTLIBNAME}.a" \      unpackmodel.1158  
      | tee -a $LOG                                                        unpackmodel.1159  
    echo "if it is neither in a default library location"                  unpackmodel.1160  
    echo "nor in the list below:"                                          unpackmodel.1161  
    echo $LCOM_PATH                                                        unpackmodel.1162  
    read ANSWER                                                            unpackmodel.1163  
    ANSWER=`eval "echo $ANSWER"`                                           unpackmodel.1164  
    echo "Answer: $ANSWER" >> $LOG                                         unpackmodel.1165  
                                                                           unpackmodel.1166  
    if test ! -z "$ANSWER"; then                                           unpackmodel.1167  
      ADDPATH=`echo $LCOM_PATH | grep $ANSWER`                             unpackmodel.1168  
      if test -z "$ADDPATH"; then                                          unpackmodel.1169  
        sed "s%LCOM_PATH=%LCOM_PATH=-L$ANSWER %" $CONFIG_TMP > $TMPFILE    unpackmodel.1170  
        mv $TMPFILE $CONFIG_TMP                                            unpackmodel.1171  
        LCOM_PATH=`getvar LCOM_PATH $CONFIG_TMP`                           unpackmodel.1172  
        echo "LCOM_PATH updated to $LCOM_PATH" >> $LOG                     unpackmodel.1173  
      fi                                                                   unpackmodel.1174  
    fi                                                                     unpackmodel.1175  
    echo >> $LOG                                                           unpackmodel.1176  
  fi                                                                       unpackmodel.1177  
fi                                                                         unpackmodel.1178  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1179  
VECTLIB=$VECTLIB                                                           unpackmodel.1180  
EOF                                                                        unpackmodel.1181  
                                                                           unpackmodel.1182  
echo                                                                       unpackmodel.1183  
                                                                           unpackmodel.1184  
UM_PE_LABEL=`getvar UM_PE_LABEL $CONFIG`                                   unpackmodel.1185  
if test "$MPP" = "true"; then                                              unpackmodel.1186  
  echo "Some MPP machines have a labelled high memory PE" | tee -a $LOG    unpackmodel.1187  
  echo "Enter the label for this PE" [$UM_PE_LABEL] | tee -a $LOG          unpackmodel.1188  
  read ANSWER                                                              unpackmodel.1189  
  UM_PE_LABEL=${ANSWER:-$UM_PE_LABEL}                                      unpackmodel.1190  
  echo "Answer: $UM_PE_LABEL" >> $LOG                                      unpackmodel.1191  
  echo                                                                     unpackmodel.1192  
  echo >> $LOG                                                             unpackmodel.1193  
fi                                                                         unpackmodel.1194  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1195  
UM_PE_LABEL=$UM_PE_LABEL                                                   unpackmodel.1196  
EOF                                                                        unpackmodel.1197  
                                                                           unpackmodel.1198  
#=======================================================================   unpackmodel.1199  
                                                                           unpackmodel.1200  
if test "$UMMACHINE" != "METOCRAY"; then                                   unpackmodel.1201  
  echo "Stage 4 - Directory Location" >> $LOG                              unpackmodel.1202  
  echo "----------------------------" >> $LOG                              unpackmodel.1203  
  echo >> $LOG                                                             unpackmodel.1204  
                                                                           unpackmodel.1205  
  echo "--------------------------------------------------------"          unpackmodel.1206  
  echo " Step 4.1: Locate UMPL & UMSL                           "          unpackmodel.1207  
  echo "--------------------------------------------------------"          unpackmodel.1208  
  echo                                                                     unpackmodel.1209  
                                                                           unpackmodel.1210  
  echo "Locating program (umpl) and script (umsl) libraries"               unpackmodel.1211  
  echo                                                                     unpackmodel.1212  
  if test "$USE_CRAY_NUPDATE" = "false"; then                              unpackmodel.1213  
                                                                           unpackmodel.1214  
    cd $UMDIR/vn$VN/source                                                 unpackmodel.1215  
                                                                           unpackmodel.1216  
    if test -d umpl.dir -a ! -d umpl; then                                 unpackmodel.1217  
      if test -f umpl; then                                                unpackmodel.1218  
        mv umpl umpl.file                                                  unpackmodel.1219  
        testcc $? "moving umpl to umpl.file"                               unpackmodel.1220  
      fi                                                                   unpackmodel.1221  
      mv umpl.dir umpl                                                     unpackmodel.1222  
      testcc $? "moving umpl.dir to umpl"                                  unpackmodel.1223  
    fi                                                                     unpackmodel.1224  
    if test -d umsl.dir -a ! -d umsl; then                                 unpackmodel.1225  
      if test -f umsl; then                                                unpackmodel.1226  
        mv umsl umsl.file                                                  unpackmodel.1227  
        testcc $? "moving umsl to umsl.file"                               unpackmodel.1228  
      fi                                                                   unpackmodel.1229  
      mv umsl.dir umsl                                                     unpackmodel.1230  
      testcc $? "moving umsl.dir to umsl"                                  unpackmodel.1231  
    fi                                                                     unpackmodel.1232  
    cd - 1>/dev/null 2>&1                                                  unpackmodel.1233  
                                                                           unpackmodel.1234  
    echo "umpl.dir renamed to umpl; umsl.dir renamed to umsl" >> $LOG      unpackmodel.1235  
                                                                           unpackmodel.1236  
    echo "--------------------------------------------------------"        unpackmodel.1237  
    echo " Step 4.2: Build Portable Nupdate                       "        unpackmodel.1238  
    echo "--------------------------------------------------------"        unpackmodel.1239  
    echo                                                                   unpackmodel.1240  
                                                                           unpackmodel.1241  
    cd $UPDATEDIR/update$UPDATEVN                                          unpackmodel.1242  
    echo "Creating portable nupdate version $UPDATEVN"                     unpackmodel.1243  
    echo                                                                   unpackmodel.1244  
                                                                           unpackmodel.1245  
    export Ccmp COPTS                                                      unpackmodel.1246  
    if test "$UMMACHINE" = "CRAYMPP" -o "$UMMACHINE" = "CRAYPVP"; then     unpackmodel.1247  
      make -f makefile.cr                                                  unpackmodel.1248  
      testcc $? "making portable nupdate"                                  unpackmodel.1249  
    else                                                                   unpackmodel.1250  
      make -f makefile.general                                             unpackmodel.1251  
      testcc $? "making portable nupdate"                                  unpackmodel.1252  
    fi                                                                     unpackmodel.1253  
#    elif test "$UMMACHINE" = "HP"; then                                   unpackmodel.1254  
#      make -f makefile.hp                                                 unpackmodel.1255  
#      testcc $? "making portable nupdate"                                 unpackmodel.1256  
#    elif test "$UMMACHINE" = "DECALPHA"; then                             unpackmodel.1257  
#      make -f makefile.da                                                 unpackmodel.1258  
#      testcc $? "making portable nupdate"                                 unpackmodel.1259  
#    elif test "$UMMACHINE" = "OTHER"; then                                unpackmodel.1260  
#      make -f makefile.other                                              unpackmodel.1261  
#      testcc $? "making portable nupdate"                                 unpackmodel.1262  
#    else                                                                  unpackmodel.1263  
#      echo "Don't know how to make portable nupdate for this platform"    unpackmodel.1264  
#      echo "Exiting script"                                               unpackmodel.1265  
#      exit 1                                                              unpackmodel.1266  
#    fi                                                                    unpackmodel.1267  
    cp nupdate mklib $UMDIR/bin                                            unpackmodel.1268  
    echo "Portable nupdate executable is located in \$UMDIR/bin"  | \      unpackmodel.1269  
      tee -a $LOG                                                          unpackmodel.1270  
    echo >> $LOG                                                           unpackmodel.1271  
    cd - 1>/dev/null 2>&1                                                  unpackmodel.1272  
  else                                                                     unpackmodel.1273  
                                                                           unpackmodel.1274  
    cd $UMDIR/vn$VN/source                                                 unpackmodel.1275  
    if test -f umpl.file -a ! -f umpl; then                                unpackmodel.1276  
      if test -d umpl; then                                                unpackmodel.1277  
        mv umpl umpl.dir                                                   unpackmodel.1278  
        testcc $? "moving umpl to umpl.dir"                                unpackmodel.1279  
      fi                                                                   unpackmodel.1280  
      mv umpl.file umpl                                                    unpackmodel.1281  
      testcc $? "moving umpl.file to umpl"                                 unpackmodel.1282  
    fi                                                                     unpackmodel.1283  
    if test -f umsl.file -a ! -f umsl; then                                unpackmodel.1284  
      if test -d umsl; then                                                unpackmodel.1285  
        mv umsl umsl.dir                                                   unpackmodel.1286  
        testcc $? "moving umsl to umsl.dir"                                unpackmodel.1287  
      fi                                                                   unpackmodel.1288  
      mv umsl.file umsl                                                    unpackmodel.1289  
      testcc $? "moving umsl.file to umsl"                                 unpackmodel.1290  
    fi                                                                     unpackmodel.1291  
    cd - 1>/dev/null 2>&1                                                  unpackmodel.1292  
                                                                           unpackmodel.1293  
    echo "umpl.file renamed to umpl; umsl.file renamed to umsl" >> $LOG    unpackmodel.1294  
  fi                                                                       unpackmodel.1295  
fi                                                                         unpackmodel.1296  
                                                                           unpackmodel.1297  
#=======================================================================   unpackmodel.1298  
                                                                           unpackmodel.1299  
echo "Stage 5 - Set up Nupdate *Defs Variables" >> $LOG                    unpackmodel.1300  
echo "----------------------------------------" >> $LOG                    unpackmodel.1301  
echo >> $LOG                                                               unpackmodel.1302  
                                                                           unpackmodel.1303  
echo "--------------------------------------------------------"            unpackmodel.1304  
echo " Step 5.1: Set up PROGDEFS                              "            unpackmodel.1305  
echo "--------------------------------------------------------"            unpackmodel.1306  
echo                                                                       unpackmodel.1307  
                                                                           unpackmodel.1308  
PROGDEFS=null                                                              unpackmodel.1309  
PROGDEFS=$FC_LINK                                                          unpackmodel.1310  
                                                                           unpackmodel.1311  
if test "$FRL8" = "true"; then                                             unpackmodel.1312  
  PROGDEFS="FRL8,$PROGDEFS"                                                unpackmodel.1313  
fi                                                                         unpackmodel.1314  
                                                                           unpackmodel.1315  
if test "$INTLL" = "true"; then                                            unpackmodel.1316  
  PROGDEFS="INTLL,$PROGDEFS"                                               unpackmodel.1317  
fi                                                                         unpackmodel.1318  
                                                                           unpackmodel.1319  
if test "$MPP" = "true"; then                                              unpackmodel.1320  
  PROGDEFS="MPP,$PROGDEFS"                                                 unpackmodel.1321  
fi                                                                         unpackmodel.1322  
                                                                           unpackmodel.1323  
if test "$MPPRECON" = "true"; then                                         unpackmodel.1324  
  PROGDEFS="MPPRECON,$PROGDEFS"                                            unpackmodel.1325  
fi                                                                         unpackmodel.1326  
                                                                           unpackmodel.1327  
if test "$BLDNOMPP" = "true"; then                                         unpackmodel.1328  
  PROGDEFS="BLDNOMPP,$PROGDEFS"                                            unpackmodel.1329  
fi                                                                         unpackmodel.1330  
                                                                           unpackmodel.1331  
if test "$CRAY" = "true"; then                                             unpackmodel.1332  
  PROGDEFS="CRAY,$PROGDEFS"                                                unpackmodel.1333  
fi                                                                         unpackmodel.1334  
                                                                           unpackmodel.1335  
# Ask BOB about CRI_OPEN                                                   unpackmodel.1336  
if test "$T3E" = "true"; then                                              unpackmodel.1337  
  PROGDEFS="T3E,CRI_OPEN,$PROGDEFS"                                        unpackmodel.1338  
fi                                                                         unpackmodel.1339  
                                                                           unpackmodel.1340  
if test "$T3D" = "true"; then                                              unpackmodel.1341  
  PROGDEFS="T3D,$PROGDEFS"                                                 unpackmodel.1342  
fi                                                                         unpackmodel.1343  
                                                                           unpackmodel.1344  
if test "$FUJITSU" = "true"; then                                          unpackmodel.1345  
  PROGDEFS="FUJITSU,$PROGDEFS"                                             unpackmodel.1346  
fi                                                                         unpackmodel.1347  
                                                                           unpackmodel.1348  
if test "$SGI" = "true"; then                                              unpackmodel.1349  
  PROGDEFS="SGI,$PROGDEFS"                                                 unpackmodel.1350  
fi                                                                         unpackmodel.1351  
                                                                           unpackmodel.1352  
if test "$SUN" = "true"; then                                              unpackmodel.1353  
  PROGDEFS="SUN,$PROGDEFS"                                                 unpackmodel.1354  
fi                                                                         unpackmodel.1355  
                                                                           unpackmodel.1356  
if test "$LINUX" = "true"; then                                            unpackmodel.1357  
  PROGDEFS="LINUX,$PROGDEFS"                                               unpackmodel.1358  
fi                                                                         unpackmodel.1359  
                                                                           unpackmodel.1360  
if test "$VECTLIB" = "true"; then                                          unpackmodel.1361  
  PROGDEFS="VECTLIB,$PROGDEFS"                                             unpackmodel.1362  
fi                                                                         unpackmodel.1363  
                                                                           unpackmodel.1364  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1365  
PROGDEFS=$PROGDEFS                                                         unpackmodel.1366  
EOF                                                                        unpackmodel.1367  
                                                                           unpackmodel.1368  
echo "--------------------------------------------------------"            unpackmodel.1369  
echo " Step 5.2: Set up SCRDEFS                               "            unpackmodel.1370  
echo "--------------------------------------------------------"            unpackmodel.1371  
echo                                                                       unpackmodel.1372  
                                                                           unpackmodel.1373  
SCRDEFS=null                                                               unpackmodel.1374  
SCRDEFS=$UMMACHINE                                                         unpackmodel.1375  
                                                                           unpackmodel.1376  
if test "$UMMACHINE" = "METOCRAY"; then                                    unpackmodel.1377  
  SCRDEFS="CRAYMPP,$SCRDEFS"                                               unpackmodel.1378  
fi                                                                         unpackmodel.1379  
                                                                           unpackmodel.1380  
if test "$VECTLIB" = "true"; then                                          unpackmodel.1381  
  SCRDEFS="VECTLIB,$SCRDEFS"                                               unpackmodel.1382  
fi                                                                         unpackmodel.1383  
                                                                           unpackmodel.1384  
if test "$MPP" = "true"; then                                              unpackmodel.1385  
  SCRDEFS="MPP,$SCRDEFS"                                                   unpackmodel.1386  
fi                                                                         unpackmodel.1387  
                                                                           unpackmodel.1388  
if test "$T3E" = "true" -o "$T3D" = "true"; then                           unpackmodel.1389  
  SCRDEFS="CRAYF90,$SCRDEFS"                                               unpackmodel.1390  
fi                                                                         unpackmodel.1391  
                                                                           unpackmodel.1392  
cat >> $CONFIG_TMP <<EOF                                                   unpackmodel.1393  
SCRDEFS=$SCRDEFS                                                           unpackmodel.1394  
EOF                                                                        unpackmodel.1395  
                                                                           unpackmodel.1396  
echo "Program nupdate *DEFS: " >> $LOG                                     unpackmodel.1397  
echo "PROGDEFS=$PROGDEFS" >> $LOG                                          unpackmodel.1398  
echo "Script nupdate *DEFS: " >> $LOG                                      unpackmodel.1399  
echo "SCRDEFS=$SCRDEFS" >> $LOG                                            unpackmodel.1400  
echo >> $LOG                                                               unpackmodel.1401  
                                                                           unpackmodel.1402  
#=======================================================================   unpackmodel.1403  
                                                                           unpackmodel.1404  
echo "Stage 6 - File Creation" >> $LOG                                     unpackmodel.1405  
echo "-----------------------" >> $LOG                                     unpackmodel.1406  
echo >> $LOG                                                               unpackmodel.1407  
                                                                           unpackmodel.1408  
if test "$UMMACHINE" != "METOCRAY"; then                                   unpackmodel.1409  
                                                                           unpackmodel.1410  
  echo "--------------------------------------------------------"          unpackmodel.1411  
  echo " Step 6.1: Setvars File                                 "          unpackmodel.1412  
  echo "--------------------------------------------------------"          unpackmodel.1413  
  echo                                                                     unpackmodel.1414  
                                                                           unpackmodel.1415  
  cat > $UM_HOME/setvars_$VN << EOF                                        unpackmodel.1416  
# Pathnames (should be different for each user)                            unpackmodel.1417  
MY_UMHOME=$MY_UMHOME                                                       unpackmodel.1418  
TMPDIR=$UM_TMP                                                             unpackmodel.1419  
MY_OUTPUT=$MY_OUTPUT                                                       unpackmodel.1420  
                                                                           unpackmodel.1421  
# Pathnames (should remain unchanged)                                      unpackmodel.1422  
UM_HOME=$UM_HOME                                                           unpackmodel.1423  
UMDIR=$UMDIR                                                               unpackmodel.1424  
UMTEST=$UMTEST                                                             unpackmodel.1425  
                                                                           unpackmodel.1426  
# Variables (may be altered for each user)                                 unpackmodel.1427  
NPROC=\${NPROC:-$NPROC}                                                    unpackmodel.1428  
                                                                           unpackmodel.1429  
# Variables (should remain unchanged)                                      unpackmodel.1430  
UMMACHINE=$UMMACHINE                                                       unpackmodel.1431  
BUILDHOST=$BUILDHOST                                                       unpackmodel.1432  
SCRDEFS=$SCRDEFS                                                           unpackmodel.1433  
PROGDEFS=$PROGDEFS                                                         unpackmodel.1434  
UM_AWK=$UM_AWK                                                             unpackmodel.1435  
UM_SED=$UM_SED                                                             unpackmodel.1436  
UM_GREP=$UM_GREP                                                           unpackmodel.1437  
                                                                           unpackmodel.1438  
# Paths                                                                    unpackmodel.1439  
PATH=\$UMDIR/bin:\$PATH:.:\$UMDIR/vn$VN/utils                              unpackmodel.1440  
FPATH=\$UMDIR/vn$VN/scripts/functions:\$FPATH                              unpackmodel.1441  
                                                                           unpackmodel.1442  
# Exports                                                                  unpackmodel.1443  
export MY_UMHOME TMPDIR MY_OUTPUT UM_HOME UMDIR UMTEST                     unpackmodel.1444  
export NPROC UMMACHINE BUILDHOST SCRDEFS PROGDEFS                          unpackmodel.1445  
export UM_AWK UM_SED UM_GREP                                               unpackmodel.1446  
export PATH FPATH                                                          unpackmodel.1447  
                                                                           unpackmodel.1448  
# Create directories if they don't exist                                   unpackmodel.1449  
[ ! -d \$MY_UMHOME ] && mkdir -p \$MY_UMHOME                               unpackmodel.1450  
[ ! -d \$TMPDIR ] && mkdir -p \$TMPDIR                                     unpackmodel.1451  
[ ! -d \$MY_OUTPUT ] && mkdir -p \$MY_OUTPUT                               unpackmodel.1452  
EOF                                                                        unpackmodel.1453  
                                                                           unpackmodel.1454  
  if test "$UMMACHINE" = "DECALPHA"                                        unpackmodel.1455  
  then                                                                     unpackmodel.1456  
    cat >> $UM_HOME/setvars_$VN << EOF                                     unpackmodel.1457  
                                                                           unpackmodel.1458  
# DecAlpha specific                                                        unpackmodel.1459  
ulimit -s 131072                                                           unpackmodel.1460  
EOF                                                                        unpackmodel.1461  
  fi                                                                       unpackmodel.1462  
                                                                           unpackmodel.1463  
  echo "$UM_HOME/setvars_$VN created" | tee -a $LOG                        unpackmodel.1464  
                                                                           unpackmodel.1465  
  chmod +x $UM_HOME/setvars_$VN                                            unpackmodel.1466  
  ln -sf $UM_HOME/setvars_$VN $UM_HOME/setvars 2>/dev/null                 unpackmodel.1467  
#  . $UM_HOME/setvars                                                      unpackmodel.1468  
                                                                           unpackmodel.1469  
fi                                                                         unpackmodel.1470  
                                                                           unpackmodel.1471  
echo "--------------------------------------------------------"            unpackmodel.1472  
echo " Step 6.2: Setglobalvars File                           "            unpackmodel.1473  
echo "--------------------------------------------------------"            unpackmodel.1474  
echo                                                                       unpackmodel.1475  
                                                                           unpackmodel.1476  
if [ ! -d $UMDIR/vn$VN ]; then                                             unpackmodel.1477  
  mkdir $UMDIR/vn$VN                                                       unpackmodel.1478  
fi                                                                         unpackmodel.1479  
if [ ! -d $UMDIR/vn$VN/scripts ]; then                                     unpackmodel.1480  
  mkdir $UMDIR/vn$VN/scripts                                               unpackmodel.1481  
fi                                                                         unpackmodel.1482  
                                                                           unpackmodel.1483  
cat > $UMDIR/vn$VN/scripts/setglobalvars << EOF                            unpackmodel.1484  
UMMACHINE=$UMMACHINE                                                       unpackmodel.1485  
UM_SECTOR_SIZE=$UM_SECTOR_SIZE                                             unpackmodel.1486  
BUILDHOST=$BUILDHOST                                                       unpackmodel.1487  
NPROC=$NPROC                                                               unpackmodel.1488  
UM_PE_LABEL=$UM_PE_LABEL                                                   unpackmodel.1489  
SCRDEFS=$SCRDEFS                                                           unpackmodel.1490  
PROGDEFS=$PROGDEFS                                                         unpackmodel.1491  
FPATH=\$UMDIR/vn$VN/scripts/functions:\$FPATH                              unpackmodel.1492  
export UMMACHINE BUILDHOST NPROC SCRDEFS PROGDEFS UM_PE_LABEL FPATH        unpackmodel.1493  
EOF                                                                        unpackmodel.1494  
                                                                           unpackmodel.1495  
echo "$UMDIR/vn$VN/scripts/setglobalvars created" | tee -a $LOG            unpackmodel.1496  
echo >> $LOG                                                               unpackmodel.1497  
                                                                           unpackmodel.1498  
echo "--------------------------------------------------------"            unpackmodel.1499  
echo " Step 6.3: Config.cache File                            "            unpackmodel.1500  
echo "--------------------------------------------------------"            unpackmodel.1501  
echo                                                                       unpackmodel.1502  
                                                                           unpackmodel.1503  
echo "OK to overwrite config.cache file? [y]"                              unpackmodel.1504  
check_tf y                                                                 unpackmodel.1505  
if test "$ANSWER" = "true"; then                                           unpackmodel.1506  
  cp $CONFIG_TMP $CONFIG                                                   unpackmodel.1507  
fi                                                                         unpackmodel.1508  
                                                                           unpackmodel.1509  
fi # End of SKIP_QUESTIONS                                                 unpackmodel.1510  
                                                                           unpackmodel.1511  
. $UM_HOME/setvars                                                         unpackmodel.1512  
                                                                           unpackmodel.1513  
#=======================================================================   unpackmodel.1514  
                                                                           unpackmodel.1515  
echo "Stage 7 - Model Unpacking" >> $LOG                                   unpackmodel.1516  
echo "-------------------------" >> $LOG                                   unpackmodel.1517  
echo >> $LOG                                                               unpackmodel.1518  
                                                                           unpackmodel.1519  
echo "--------------------------------------------------------"            unpackmodel.1520  
echo " Step 7.1: Script Extraction                            "            unpackmodel.1521  
echo "--------------------------------------------------------"            unpackmodel.1522  
echo                                                                       unpackmodel.1523  
                                                                           unpackmodel.1524  
echo "The following options have been set..."                              unpackmodel.1525  
sleep 2                                                                    unpackmodel.1526  
more $CONFIG                                                               unpackmodel.1527  
rm -f $CONFIG_TMP                                                          unpackmodel.1528  
echo                                                                       unpackmodel.1529  
echo "OK to go ahead and unpack the UM with these options? [y]"            unpackmodel.1530  
check_tf y                                                                 unpackmodel.1531  
if test "$ANSWER" != "true"; then                                          unpackmodel.1532  
  echo "Program terminating without unpacking the UM" | tee -a $LOG        unpackmodel.1533  
  exit 1                                                                   unpackmodel.1534  
fi                                                                         unpackmodel.1535  
                                                                           unpackmodel.1536  
if [ ! -d $UMDIR/vn$VN/scripts/Install ]; then                             unpackmodel.1537  
  mkdir $UMDIR/vn$VN/scripts/Install                                       unpackmodel.1538  
fi                                                                         unpackmodel.1539  
cd $UMDIR/vn$VN/scripts/Install                                            unpackmodel.1540  
nupdate -p $UMDIR/vn$VN/source/umsl -q mkscripts -c mkscripts -a f         unpackmodel.1541  
testcc $? "running nupdate to create mkscripts"                            unpackmodel.1542  
                                                                           unpackmodel.1543  
sed "s/ *$//" mkscripts.f > mkscripts                                      unpackmodel.1544  
rm mkscripts.f                                                             unpackmodel.1545  
chmod 755 mkscripts                                                        unpackmodel.1546  
                                                                           unpackmodel.1547  
echo "Starting script extraction" | tee -a $LOG                            unpackmodel.1548  
echo | tee -a $LOG                                                         unpackmodel.1549  
                                                                           unpackmodel.1550  
./mkscripts >> $LOG                                                        unpackmodel.1551  
testcc $? "running mkscripts"                                              unpackmodel.1552  
                                                                           unpackmodel.1553  
echo "Script extraction complete"                                          unpackmodel.1554  
echo                                                                       unpackmodel.1555  
                                                                           unpackmodel.1556  
echo "--------------------------------------------------------"            unpackmodel.1557  
echo " Step 7.2: Create cross reference files                 "            unpackmodel.1558  
echo "--------------------------------------------------------"            unpackmodel.1559  
echo                                                                       unpackmodel.1560  
                                                                           unpackmodel.1561  
. $UMDIR/vn$VN/scripts/setglobalvars >> $LOG                               unpackmodel.1562  
                                                                           unpackmodel.1563  
echo "Making obj_xref" >> $LOG                                             unpackmodel.1564  
echo >> $LOG                                                               unpackmodel.1565  
$UMDIR/vn$VN/scripts/mkobjxref \                                           unpackmodel.1566  
  $UMDIR/vn$VN/source/obj_xref_base \                                      unpackmodel.1567  
  $UMDIR/vn$VN/source/obj_xref \                                           unpackmodel.1568  
  $BUILDHOST >>$LOG                                                        unpackmodel.1569  
testcc $? "creating obj_xref"                                              unpackmodel.1570  
                                                                           unpackmodel.1571  
echo >> $LOG                                                               unpackmodel.1572  
                                                                           unpackmodel.1573  
echo "Making exec_xref" >> $LOG                                            unpackmodel.1574  
echo >> $LOG                                                               unpackmodel.1575  
$UMDIR/vn$VN/scripts/mkexecxref \                                          unpackmodel.1576  
  $UMDIR/vn$VN/source/exec_xref_base \                                     unpackmodel.1577  
  $UMDIR/vn$VN/source/exec_xref \                                          unpackmodel.1578  
  $BUILDHOST >>$LOG                                                        unpackmodel.1579  
testcc $? "creating exec_xref"                                             unpackmodel.1580  
                                                                           unpackmodel.1581  
echo "Cross reference file creation complete"                              unpackmodel.1582  
echo                                                                       unpackmodel.1583  
                                                                           unpackmodel.1584  
echo "--------------------------------------------------------"            unpackmodel.1585  
echo " Step 7.3: Create compile_vars file                     "            unpackmodel.1586  
echo "--------------------------------------------------------"            unpackmodel.1587  
echo                                                                       unpackmodel.1588  
                                                                           unpackmodel.1589  
$UMDIR/vn$VN/scripts/mkcompvars \                                          unpackmodel.1590  
  $UMDIR/vn$VN/source/compile_vars \                                       unpackmodel.1591  
  $COM_SPECIFIC >>$LOG                                                     unpackmodel.1592  
testcc $? "creating compile_vars"                                          unpackmodel.1593  
                                                                           unpackmodel.1594  
echo "Compile_vars file creation complete"                                 unpackmodel.1595  
echo                                                                       unpackmodel.1596  
                                                                           unpackmodel.1597  
echo "--------------------------------------------------------"            unpackmodel.1598  
echo " Step 7.4: Tidy up                                      "            unpackmodel.1599  
echo "--------------------------------------------------------"            unpackmodel.1600  
echo                                                                       unpackmodel.1601  
                                                                           unpackmodel.1602  
if test "$UMMACHINE" != "METOCRAY"; then                                   unpackmodel.1603  
  echo "NOTE: Check the file $LOG"                                         unpackmodel.1604  
  echo "      to make sure that UM unpacking has been successful."         unpackmodel.1605  
  echo "      Remember to source the file $UM_HOME/setvars in order"       unpackmodel.1606  
  echo "      to access the UM environment variables."                     unpackmodel.1607  
  echo "      Type:"                                                       unpackmodel.1608  
  echo "      . $UM_HOME/setvars"                                          unpackmodel.1609  
  echo "      and add this to your logon profile"                          unpackmodel.1610  
fi                                                                         unpackmodel.1611  
                                                                           unpackmodel.1612  
echo >> $LOG                                                               unpackmodel.1613  
echo "Model unpacking finished at `date`" | tee -a $LOG                    unpackmodel.1614  
